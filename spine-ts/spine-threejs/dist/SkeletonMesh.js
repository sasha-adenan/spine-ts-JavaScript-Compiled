/******************************************************************************
 * Spine Runtimes License Agreement
 * Last updated April 5, 2025. Replaces all prior versions.
 *
 * Copyright (c) 2013-2025, Esoteric Software LLC
 *
 * Integration of the Spine Runtimes into software or otherwise creating
 * derivative works of the Spine Runtimes is permitted under the terms and
 * conditions of Section 2 of the Spine Editor License Agreement:
 * http://esotericsoftware.com/spine-editor-license
 *
 * Otherwise, it is permitted to integrate the Spine Runtimes into software
 * or otherwise create derivative works of the Spine Runtimes (collectively,
 * "Products"), provided that each user of the Products must obtain their own
 * Spine Editor license and redistribution of the Products in any form must
 * include this license and copyright notice.
 *
 * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,
 * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************/
import * as THREE from "three";
import { AnimationState, AnimationStateData, ClippingAttachment, Color, MeshAttachment, Physics, RegionAttachment, Skeleton, SkeletonClipping, Utils, Vector2, } from "@esotericsoftware/spine-core";
import { MeshBatcher } from "./MeshBatcher.js";
export class SkeletonMesh extends THREE.Object3D {
    // public static readonly DEFAULT_MATERIAL_PARAMETERS: THREE.MaterialParameters = {
    static DEFAULT_MATERIAL_PARAMETERS = {
        side: THREE.DoubleSide,
        depthWrite: true,
        depthTest: true,
        transparent: true,
        alphaTest: 0.001,
        vertexColors: true,
        premultipliedAlpha: true,
    };
    tempPos = new Vector2();
    tempUv = new Vector2();
    tempLight = new Color();
    tempDark = new Color();
    skeleton;
    state;
    zOffset = 0.1;
    batches = new Array();
    materialFactory;
    nextBatchIndex = 0;
    clipper = new SkeletonClipping();
    static QUAD_TRIANGLES = [0, 1, 2, 2, 3, 0];
    static VERTEX_SIZE = 2 + 2 + 4;
    vertexSize = 2 + 2 + 4;
    twoColorTint;
    vertices = Utils.newFloatArray(1024);
    tempColor = new Color();
    tempDarkColor = new Color();
    _castShadow = false;
    _receiveShadow = false;
    constructor(skeletonDataOrConfiguration, materialCustomizer = () => { }) {
        super();
        if (!('skeletonData' in skeletonDataOrConfiguration)) {
            const materialFactory = () => {
                const parameters = { ...SkeletonMesh.DEFAULT_MATERIAL_PARAMETERS };
                materialCustomizer(parameters);
                return new THREE.MeshBasicMaterial(parameters);
            };
            skeletonDataOrConfiguration = {
                skeletonData: skeletonDataOrConfiguration,
                materialFactory,
            };
        }
        this.twoColorTint = skeletonDataOrConfiguration.twoColorTint ?? true;
        if (this.twoColorTint) {
            this.vertexSize += 4;
        }
        this.materialFactory = skeletonDataOrConfiguration.materialFactory ?? (() => new THREE.MeshBasicMaterial(SkeletonMesh.DEFAULT_MATERIAL_PARAMETERS));
        this.skeleton = new Skeleton(skeletonDataOrConfiguration.skeletonData);
        let animData = new AnimationStateData(skeletonDataOrConfiguration.skeletonData);
        this.state = new AnimationState(animData);
        Object.defineProperty(this, 'castShadow', {
            get: () => this._castShadow,
            set: (value) => {
                this._castShadow = value;
                this.traverse((child) => {
                    if (child instanceof MeshBatcher) {
                        child.castShadow = value;
                    }
                });
            },
        });
        Object.defineProperty(this, 'receiveShadow', {
            get: () => this._receiveShadow,
            set: (value) => {
                this._receiveShadow = value;
                // Propagate to children
                this.traverse((child) => {
                    if (child instanceof MeshBatcher) {
                        child.receiveShadow = value;
                    }
                });
            },
        });
    }
    update(deltaTime) {
        let state = this.state;
        let skeleton = this.skeleton;
        state.update(deltaTime);
        state.apply(skeleton);
        skeleton.update(deltaTime);
        skeleton.updateWorldTransform(Physics.update);
        this.updateGeometry();
    }
    dispose() {
        for (var i = 0; i < this.batches.length; i++) {
            this.batches[i].dispose();
        }
    }
    clearBatches() {
        for (var i = 0; i < this.batches.length; i++) {
            this.batches[i].clear();
            this.batches[i].visible = false;
        }
        this.nextBatchIndex = 0;
    }
    nextBatch() {
        if (this.batches.length == this.nextBatchIndex) {
            let batch = new MeshBatcher(MeshBatcher.MAX_VERTICES, this.materialFactory, this.twoColorTint);
            batch.castShadow = this._castShadow;
            batch.receiveShadow = this._receiveShadow;
            this.add(batch);
            this.batches.push(batch);
        }
        let batch = this.batches[this.nextBatchIndex++];
        batch.visible = true;
        return batch;
    }
    updateGeometry() {
        this.clearBatches();
        let tempLight = this.tempLight;
        let tempDark = this.tempDark;
        let clipper = this.clipper;
        let vertices = this.vertices;
        let triangles = null;
        let uvs = null;
        let drawOrder = this.skeleton.drawOrder;
        let batch = this.nextBatch();
        batch.begin();
        let z = 0;
        let zOffset = this.zOffset;
        for (let i = 0, n = drawOrder.length; i < n; i++) {
            let vertexSize = clipper.isClipping() ? 2 : this.vertexSize;
            let slot = drawOrder[i];
            if (!slot.bone.active) {
                clipper.clipEndWithSlot(slot);
                continue;
            }
            let attachment = slot.getAttachment();
            let attachmentColor;
            let texture;
            let numFloats = 0;
            if (attachment instanceof RegionAttachment) {
                let region = attachment;
                attachmentColor = region.color;
                vertices = this.vertices;
                numFloats = vertexSize * 4;
                region.computeWorldVertices(slot, vertices, 0, vertexSize);
                triangles = SkeletonMesh.QUAD_TRIANGLES;
                uvs = region.uvs;
                texture = region.region.texture;
            }
            else if (attachment instanceof MeshAttachment) {
                let mesh = attachment;
                attachmentColor = mesh.color;
                vertices = this.vertices;
                numFloats = (mesh.worldVerticesLength >> 1) * vertexSize;
                if (numFloats > vertices.length) {
                    vertices = this.vertices = Utils.newFloatArray(numFloats);
                }
                mesh.computeWorldVertices(slot, 0, mesh.worldVerticesLength, vertices, 0, vertexSize);
                triangles = mesh.triangles;
                uvs = mesh.uvs;
                texture = mesh.region.texture;
            }
            else if (attachment instanceof ClippingAttachment) {
                let clip = attachment;
                clipper.clipStart(slot, clip);
                continue;
            }
            else {
                clipper.clipEndWithSlot(slot);
                continue;
            }
            if (texture != null) {
                let skeleton = slot.bone.skeleton;
                let skeletonColor = skeleton.color;
                let slotColor = slot.color;
                let alpha = skeletonColor.a * slotColor.a * attachmentColor.a;
                let color = this.tempColor;
                color.set(skeletonColor.r * slotColor.r * attachmentColor.r * alpha, skeletonColor.g * slotColor.g * attachmentColor.g * alpha, skeletonColor.b * slotColor.b * attachmentColor.b * alpha, alpha);
                let darkColor = this.tempDarkColor;
                if (!slot.darkColor)
                    darkColor.set(0, 0, 0, 1);
                else {
                    darkColor.r = slot.darkColor.r * alpha;
                    darkColor.g = slot.darkColor.g * alpha;
                    darkColor.b = slot.darkColor.b * alpha;
                    darkColor.a = 1;
                }
                let finalVertices;
                let finalVerticesLength;
                let finalIndices;
                let finalIndicesLength;
                if (clipper.isClipping()) {
                    clipper.clipTriangles(vertices, triangles, triangles.length, uvs, color, tempLight, this.twoColorTint);
                    let clippedVertices = clipper.clippedVertices;
                    let clippedTriangles = clipper.clippedTriangles;
                    finalVertices = clippedVertices;
                    finalVerticesLength = clippedVertices.length;
                    finalIndices = clippedTriangles;
                    finalIndicesLength = clippedTriangles.length;
                }
                else {
                    let verts = vertices;
                    if (!this.twoColorTint) {
                        for (let v = 2, u = 0, n = numFloats; v < n; v += vertexSize, u += 2) {
                            verts[v] = color.r;
                            verts[v + 1] = color.g;
                            verts[v + 2] = color.b;
                            verts[v + 3] = color.a;
                            verts[v + 4] = uvs[u];
                            verts[v + 5] = uvs[u + 1];
                        }
                    }
                    else {
                        for (let v = 2, u = 0, n = numFloats; v < n; v += vertexSize, u += 2) {
                            verts[v] = color.r;
                            verts[v + 1] = color.g;
                            verts[v + 2] = color.b;
                            verts[v + 3] = color.a;
                            verts[v + 4] = uvs[u];
                            verts[v + 5] = uvs[u + 1];
                            verts[v + 6] = darkColor.r;
                            verts[v + 7] = darkColor.g;
                            verts[v + 8] = darkColor.b;
                            verts[v + 9] = darkColor.a;
                        }
                    }
                    finalVertices = vertices;
                    finalVerticesLength = numFloats;
                    finalIndices = triangles;
                    finalIndicesLength = triangles.length;
                }
                if (finalVerticesLength == 0 || finalIndicesLength == 0) {
                    clipper.clipEndWithSlot(slot);
                    continue;
                }
                // Start new batch if this one can't hold vertices/indices
                if (!batch.canBatch(finalVerticesLength / this.vertexSize, finalIndicesLength)) {
                    batch.end();
                    batch = this.nextBatch();
                    batch.begin();
                }
                const slotBlendMode = slot.data.blendMode;
                const slotTexture = texture.texture;
                const materialGroup = batch.findMaterialGroup(slotTexture, slotBlendMode);
                batch.addMaterialGroup(finalIndicesLength, materialGroup);
                batch.batch(finalVertices, finalVerticesLength, finalIndices, finalIndicesLength, z);
                z += zOffset;
            }
            clipper.clipEndWithSlot(slot);
        }
        clipper.clipEnd();
        batch.end();
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2tlbGV0b25NZXNoLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL1NrZWxldG9uTWVzaC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OytFQTJCK0U7QUFFL0UsT0FBTyxLQUFLLEtBQUssTUFBTSxPQUFPLENBQUM7QUFDL0IsT0FBTyxFQUNOLGNBQWMsRUFDZCxrQkFBa0IsRUFDbEIsa0JBQWtCLEVBQ2xCLEtBQUssRUFDTCxjQUFjLEVBRWQsT0FBTyxFQUNQLGdCQUFnQixFQUNoQixRQUFRLEVBQ1IsZ0JBQWdCLEVBSWhCLEtBQUssRUFDTCxPQUFPLEdBQ1AsTUFBTSw4QkFBOEIsQ0FBQztBQUV0QyxPQUFPLEVBQW1CLFdBQVcsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBMkJoRSxNQUFNLE9BQU8sWUFBYSxTQUFRLEtBQUssQ0FBQyxRQUFRO0lBQy9DLG1GQUFtRjtJQUM1RSxNQUFNLENBQVUsMkJBQTJCLEdBQTZCO1FBQzlFLElBQUksRUFBRSxLQUFLLENBQUMsVUFBVTtRQUN0QixVQUFVLEVBQUUsSUFBSTtRQUNoQixTQUFTLEVBQUUsSUFBSTtRQUNmLFdBQVcsRUFBRSxJQUFJO1FBQ2pCLFNBQVMsRUFBRSxLQUFLO1FBQ2hCLFlBQVksRUFBRSxJQUFJO1FBQ2xCLGtCQUFrQixFQUFFLElBQUk7S0FDeEIsQ0FBQTtJQUVELE9BQU8sR0FBWSxJQUFJLE9BQU8sRUFBRSxDQUFDO0lBQ2pDLE1BQU0sR0FBWSxJQUFJLE9BQU8sRUFBRSxDQUFDO0lBQ2hDLFNBQVMsR0FBRyxJQUFJLEtBQUssRUFBRSxDQUFDO0lBQ3hCLFFBQVEsR0FBRyxJQUFJLEtBQUssRUFBRSxDQUFDO0lBQ3ZCLFFBQVEsQ0FBVztJQUNuQixLQUFLLENBQWlCO0lBQ3RCLE9BQU8sR0FBVyxHQUFHLENBQUM7SUFFZCxPQUFPLEdBQUcsSUFBSSxLQUFLLEVBQWUsQ0FBQztJQUNuQyxlQUFlLENBQTREO0lBQzNF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QUFDLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQzs0QkFDdkIsS0FBSyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDOzRCQUN2QixLQUFLLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUM7NEJBQ3ZCLEtBQUssQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDOzRCQUN0QixLQUFLLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7d0JBQzNCLENBQUM7b0JBQ0YsQ0FBQzt5QkFBTSxDQUFDO3dCQUNQLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFNBQVMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsSUFBSSxVQUFVLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDOzRCQUN0RSxLQUFLLENBQUMsQ0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQzs0QkFDbkIsS0FBSyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDOzRCQUN2QixLQUFLLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUM7NEJBQ3ZCLEtBQUssQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQzs0QkFDdkIsS0FBSyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7NEJBQ3RCLEtBQUssQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQzs0QkFDMUIsS0FBSyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxTQUFTLENBQUMsQ0FBQyxDQUFDOzRCQUMzQixLQUFLLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLFNBQVMsQ0FBQyxDQUFDLENBQUM7NEJBQzNCLEtBQUssQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQzs0QkFDM0IsS0FBSyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxTQUFTLENBQUMsQ0FBQyxDQUFDO3dCQUM1QixDQUFDO29CQUNGLENBQUM7b0JBRUQsYUFBYSxHQUFHLFFBQVEsQ0FBQztvQkFDekIsbUJBQW1CLEdBQUcsU0FBUyxDQUFDO29CQUNoQyxZQUFZLEdBQUcsU0FBUyxDQUFDO29CQUN6QixrQkFBa0IsR0FBRyxTQUFTLENBQUMsTUFBTSxDQUFDO2dCQUN2QyxDQUFDO2dCQUVELElBQUksbUJBQW1CLElBQUksQ0FBQyxJQUFJLGtCQUFrQixJQUFJLENBQUMsRUFBRSxDQUFDO29CQUN6RCxPQUFPLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDO29CQUM5QixTQUFTO2dCQUNWLENBQUM7Z0JBRUQsMERBQTBEO2dCQUMxRCxJQUNDLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FDZCxtQkFBbUIsR0FBRyxJQUFJLENBQUMsVUFBVSxFQUNyQyxrQkFBa0IsQ0FDbEIsRUFDQSxDQUFDO29CQUNGLEtBQUssQ0FBQyxHQUFHLEVBQUUsQ0FBQztvQkFDWixLQUFLLEdBQUcsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO29CQUN6QixLQUFLLENBQUMsS0FBSyxFQUFFLENBQUM7Z0JBQ2YsQ0FBQztnQkFFRCxNQUFNLGFBQWEsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQztnQkFDMUMsTUFBTSxXQUFXLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQztnQkFDcEMsTUFBTSxhQUFhLEdBQUcsS0FBSyxDQUFDLGlCQUFpQixDQUM1QyxXQUFXLEVBQ1gsYUFBYSxDQUNiLENBQUM7Z0JBRUYsS0FBSyxDQUFDLGdCQUFnQixDQUFDLGtCQUFrQixFQUFFLGFBQWEsQ0FBQyxDQUFDO2dCQUMxRCxLQUFLLENBQUMsS0FBSyxDQUNWLGFBQWEsRUFDYixtQkFBbUIsRUFDbkIsWUFBWSxFQUNaLGtCQUFrQixFQUNsQixDQUFDLENBQ0QsQ0FBQztnQkFDRixDQUFDLElBQUksT0FBTyxDQUFDO1lBQ2QsQ0FBQztZQUVELE9BQU8sQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDL0IsQ0FBQztRQUNELE9BQU8sQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUNsQixLQUFLLENBQUMsR0FBRyxFQUFFLENBQUM7SUFDYixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICogU3BpbmUgUnVudGltZXMgTGljZW5zZSBBZ3JlZW1lbnRcbiAqIExhc3QgdXBkYXRlZCBBcHJpbCA1LCAyMDI1LiBSZXBsYWNlcyBhbGwgcHJpb3IgdmVyc2lvbnMuXG4gKlxuICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMjUsIEVzb3RlcmljIFNvZnR3YXJlIExMQ1xuICpcbiAqIEludGVncmF0aW9uIG9mIHRoZSBTcGluZSBSdW50aW1lcyBpbnRvIHNvZnR3YXJlIG9yIG90aGVyd2lzZSBjcmVhdGluZ1xuICogZGVyaXZhdGl2ZSB3b3JrcyBvZiB0aGUgU3BpbmUgUnVudGltZXMgaXMgcGVybWl0dGVkIHVuZGVyIHRoZSB0ZXJtcyBhbmRcbiAqIGNvbmRpdGlvbnMgb2YgU2VjdGlvbiAyIG9mIHRoZSBTcGluZSBFZGl0b3IgTGljZW5zZSBBZ3JlZW1lbnQ6XG4gKiBodHRwOi8vZXNvdGVyaWNzb2Z0d2FyZS5jb20vc3BpbmUtZWRpdG9yLWxpY2Vuc2VcbiAqXG4gKiBPdGhlcndpc2UsIGl0IGlzIHBlcm1pdHRlZCB0byBpbnRlZ3JhdGUgdGhlIFNwaW5lIFJ1bnRpbWVzIGludG8gc29mdHdhcmVcbiAqIG9yIG90aGVyd2lzZSBjcmVhdGUgZGVyaXZhdGl2ZSB3b3JrcyBvZiB0aGUgU3BpbmUgUnVudGltZXMgKGNvbGxlY3RpdmVseSxcbiAqIFwiUHJvZHVjdHNcIiksIHByb3ZpZGVkIHRoYXQgZWFjaCB1c2VyIG9mIHRoZSBQcm9kdWN0cyBtdXN0IG9idGFpbiB0aGVpciBvd25cbiAqIFNwaW5lIEVkaXRvciBsaWNlbnNlIGFuZCByZWRpc3RyaWJ1dGlvbiBvZiB0aGUgUHJvZHVjdHMgaW4gYW55IGZvcm0gbXVzdFxuICogaW5jbHVkZSB0aGlzIGxpY2Vuc2UgYW5kIGNvcHlyaWdodCBub3RpY2UuXG4gKlxuICogVEhFIFNQSU5FIFJVTlRJTUVTIEFSRSBQUk9WSURFRCBCWSBFU09URVJJQyBTT0ZUV0FSRSBMTEMgXCJBUyBJU1wiIEFORCBBTllcbiAqIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFIElNUExJRURcbiAqIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBUkVcbiAqIERJU0NMQUlNRUQuIElOIE5PIEVWRU5UIFNIQUxMIEVTT1RFUklDIFNPRlRXQVJFIExMQyBCRSBMSUFCTEUgRk9SIEFOWVxuICogRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVNcbiAqIChJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgUFJPQ1VSRU1FTlQgT0YgU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUyxcbiAqIEJVU0lORVNTIElOVEVSUlVQVElPTiwgT1IgTE9TUyBPRiBVU0UsIERBVEEsIE9SIFBST0ZJVFMpIEhPV0VWRVIgQ0FVU0VEIEFORFxuICogT04gQU5ZIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlRcbiAqIChJTkNMVURJTkcgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRlxuICogVEhFIFNQSU5FIFJVTlRJTUVTLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLlxuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuXG5pbXBvcnQgKiBhcyBUSFJFRSBmcm9tIFwidGhyZWVcIjtcbmltcG9ydCB7XG5cdEFuaW1hdGlvblN0YXRlLFxuXHRBbmltYXRpb25TdGF0ZURhdGEsXG5cdENsaXBwaW5nQXR0YWNobWVudCxcblx0Q29sb3IsXG5cdE1lc2hBdHRhY2htZW50LFxuXHROdW1iZXJBcnJheUxpa2UsXG5cdFBoeXNpY3MsXG5cdFJlZ2lvbkF0dGFjaG1lbnQsXG5cdFNrZWxldG9uLFxuXHRTa2VsZXRvbkNsaXBwaW5nLFxuXHRTa2VsZXRvbkRhdGEsXG5cdFNrZWxldG9uQmluYXJ5LFxuXHRTa2VsZXRvbkpzb24sXG5cdFV0aWxzLFxuXHRWZWN0b3IyLFxufSBmcm9tIFwiQGVzb3Rlcmljc29mdHdhcmUvc3BpbmUtY29yZVwiO1xuXG5pbXBvcnQgeyBNYXRlcmlhbFdpdGhNYXAsIE1lc2hCYXRjaGVyIH0gZnJvbSBcIi4vTWVzaEJhdGNoZXIuanNcIjtcbmltcG9ydCB7IFRocmVlSnNUZXh0dXJlIH0gZnJvbSBcIi4vVGhyZWVKc1RleHR1cmUuanNcIjtcblxudHlwZSBTa2VsZXRvbk1lc2hNYXRlcmlhbFBhcmFtZXRlcnNDdXN0b21pemVyID0gKG1hdGVyaWFsUGFyYW1ldGVyczogVEhSRUUuTWF0ZXJpYWxQYXJhbWV0ZXJzKSA9PiB2b2lkO1xudHlwZSBTa2VsZXRvbk1lc2hDb25maWd1cmF0aW9uID0ge1xuXG5cdC8qKiBUaGUgc2tlbGV0b24gZGF0YSBvYmplY3QgbG9hZGVkIGJ5IHVzaW5nIHtAbGluayBTa2VsZXRvbkpzb259IG9yIHtAbGluayBTa2VsZXRvbkJpbmFyeX0gKi9cblx0c2tlbGV0b25EYXRhOiBTa2VsZXRvbkRhdGEsXG5cblx0LyoqIFNldCBpdCB0byB0cnVlIHRvIGVuYWJsZSB0aW50IGJsYWNrIHJlbmRlcmluZyAqL1xuXHR0d29Db2xvclRpbnQ/OiBib29sZWFuLFxuXG5cdC8qKlxuXHQgKiBUaGUgZnVuY3Rpb24gdXNlZCB0byBjcmVhdGUgdGhlIG1hdGVyaWFscyBmb3IgdGhlIG1lc2hlcyBjb21wb3NpbmcgdGhpcyBPYmplY3QzRC5cblx0ICogVGhlIG1hdGVyaWFsIHVzZWQgbXVzdCBoYXZlIHRoZSBgbWFwYCBwcm9wZXJ0eS5cblx0ICogQnkgZGVmYXVsdCBhIE1lc2hTdGFuZGFyZE1hdGVyaWFsIGlzIHVzZWQsIHNvIG5vIGxpZ2h0IGFuZCBzaGFkb3dzIGFyZSBhdmFpbGFibGUuXG5cdCAqIFVzZSBhIE1lc2hTdGFuZGFyZE1hdGVyaWFsXG5cdCAqXG5cdCAqIEBwYXJhbSBwYXJhbWV0ZXJzIFRoZSBkZWZhdWx0IHBhcmFtZXRlcnMgd2l0aCB3aGljaCB0aGlzIGZ1bmN0aW9uIGlzIGludm9rZWQuXG5cdCAqIFlvdSBzaG91bGQgcGFzcyB0aGlzIHBhcmFtZXRlcnMsIG9uY2UgcGVyc29uYWxpemVkLCB0byB0aGUgY29zdHJ1Y3RvciBvZiB0aGUgbWF0ZXJpYWwgeW91IHdhbnQgdG8gdXNlLlxuXHQgKiBEZWZhdWx0IHZhbHVlcyBhcmUgZGVmaW5lZCBpbiB7QGxpbmsgU2tlbGV0b25NZXNoLkRFRkFVTFRfTUFURVJJQUxfUEFSQU1FVEVSU30uXG5cdCAqXG5cdCAqIEByZXR1cm5zIEFuIGluc3RhbmNlIG9mIHRoZSBtYXRlcmlhbCB5b3Ugd2FudCB0byBiZSB1c2VkIGZvciB0aGUgbWVzaGVzIG9mIHRoaXMgT2JqZWN0M0QuIFRoZSBtYXRlcmlhbCBtdXN0IGhhdmUgdGhlIGBtYXBgIHByb3BlcnR5LlxuXHQgKi9cblx0bWF0ZXJpYWxGYWN0b3J5PzogKHBhcmFtZXRlcnM6IFRIUkVFLk1hdGVyaWFsUGFyYW1ldGVycykgPT4gTWF0ZXJpYWxXaXRoTWFwLFxufTtcblxuZXhwb3J0IGNsYXNzIFNrZWxldG9uTWVzaCBleHRlbmRzIFRIUkVFLk9iamVjdDNEIHtcblx0Ly8gcHVibGljIHN0YXRpYyByZWFkb25seSBERUZBVUxUX01BVEVSSUFMX1BBUkFNRVRFUlM6IFRIUkVFLk1hdGVyaWFsUGFyYW1ldGVycyA9IHtcblx0cHVibGljIHN0YXRpYyByZWFkb25seSBERUZBVUxUX01BVEVSSUFMX1BBUkFNRVRFUlM6IFRIUkVFLk1hdGVyaWFsUGFyYW1ldGVycyA9IHtcblx0XHRzaWRlOiBUSFJFRS5Eb3VibGVTaWRlLFxuXHRcdGRlcHRoV3JpdGU6IHRydWUsXG5cdFx0ZGVwdGhUZXN0OiB0cnVlLFxuXHRcdHRyYW5zcGFyZW50OiB0cnVlLFxuXHRcdGFscGhhVGVzdDogMC4wMDEsXG5cdFx0dmVydGV4Q29sb3JzOiB0cnVlLFxuXHRcdHByZW11bHRpcGxpZWRBbHBoYTogdHJ1ZSxcblx0fVxuXG5cdHRlbXBQb3M6IFZlY3RvcjIgPSBuZXcgVmVjdG9yMigpO1xuXHR0ZW1wVXY6IFZlY3RvcjIgPSBuZXcgVmVjdG9yMigpO1xuXHR0ZW1wTGlnaHQgPSBuZXcgQ29sb3IoKTtcblx0dGVtcERhcmsgPSBuZXcgQ29sb3IoKTtcblx0c2tlbGV0b246IFNrZWxldG9uO1xuXHRzdGF0ZTogQW5pbWF0aW9uU3RhdGU7XG5cdHpPZmZzZXQ6IG51bWJlciA9IDAuMTtcblxuXHRwcml2YXRlIGJhdGNoZXMgPSBuZXcgQXJyYXk8TWVzaEJhdGNoZXI+KCk7XG5cdHByaXZhdGUgbWF0ZXJpYWxGYWN0b3J5OiAocGFyYW1ldGVyczogVEhSRUUuTWF0ZXJpYWxQYXJhbWV0ZXJzKSA9PiBNYXRlcmlhbFdpdGhNYXA7XG5cdHByaXZhdGUgbmV4dEJhdGNoSW5kZXggPSAwO1xuXHRwcml2YXRlIGNsaXBwZXI6IFNrZWxldG9uQ2xpcHBpbmcgPSBuZXcgU2tlbGV0b25DbGlwcGluZygpO1xuXG5cdHN0YXRpYyBRVUFEX1RSSUFOR0xFUyA9IFswLCAxLCAyLCAyLCAzLCAwXTtcblx0c3RhdGljIFZFUlRFWF9TSVpFID0gMiArIDIgKyA0O1xuXHRwcml2YXRlIHZlcnRleFNpemUgPSAyICsgMiArIDQ7XG5cdHByaXZhdGUgdHdvQ29sb3JUaW50O1xuXG5cdHByaXZhdGUgdmVydGljZXMgPSBVdGlscy5uZXdGbG9hdEFycmF5KDEwMjQpO1xuXHRwcml2YXRlIHRlbXBDb2xvciA9IG5ldyBDb2xvcigpO1xuXHRwcml2YXRlIHRlbXBEYXJrQ29sb3IgPSBuZXcgQ29sb3IoKTtcblxuXHRwcml2YXRlIF9jYXN0U2hhZG93ID0gZmFsc2U7XG5cdHByaXZhdGUgX3JlY2VpdmVTaGFkb3cgPSBmYWxzZTtcblxuXHQvKipcblx0ICogQ3JlYXRlIGFuIE9iamVjdDNEIGNvbnRhaW5pbmcgbWVzaGVzIHJlcHJlc2VudGluZyB5b3VyIFNwaW5lIGFuaW1hdGlvbi5cblx0ICogUGVyc29uYWxpemUgeW91ciBtYXRlcmlhbCBwcm92aWRpbmcgYSB7QGxpbmsgU2tlbGV0b25NZXNoQ29uZmlndXJhdGlvbn1cblx0ICogQHBhcmFtIHNrZWxldG9uRGF0YVxuXHQgKi9cblx0Y29uc3RydWN0b3IgKGNvbmZpZ3VyYXRpb246IFNrZWxldG9uTWVzaENvbmZpZ3VyYXRpb24pXG5cdC8qKlxuXHQgKiBAZGVwcmVjYXRlZCBUaGlzIHNpZ25hdHVyZSBpcyBkZXByZWNhdGVkLCBwbGVhc2UgdXNlIHRoZSBvbmUgd2l0aCBhIHNpbmdsZSB7QGxpbmsgU2tlbGV0b25NZXNoQ29uZmlndXJhdGlvbn0gcGFyYW1ldGVyXG5cdCAqL1xuXHRjb25zdHJ1Y3RvciAoXG5cdFx0c2tlbGV0b25EYXRhOiBTa2VsZXRvbkRhdGEsXG5cdFx0bWF0ZXJpYWxDdXN0b21pemVyOiBTa2VsZXRvbk1lc2hNYXRlcmlhbFBhcmFtZXRlcnNDdXN0b21pemVyLFxuXHQpXG5cdGNvbnN0cnVjdG9yIChcblx0XHRza2VsZXRvbkRhdGFPckNvbmZpZ3VyYXRpb246IFNrZWxldG9uRGF0YSB8IFNrZWxldG9uTWVzaENvbmZpZ3VyYXRpb24sXG5cdFx0bWF0ZXJpYWxDdXN0b21pemVyOiBTa2VsZXRvbk1lc2hNYXRlcmlhbFBhcmFtZXRlcnNDdXN0b21pemVyID0gKCkgPT4geyB9XG5cdCkge1xuXHRcdHN1cGVyKCk7XG5cblx0XHRpZiAoISgnc2tlbGV0b25EYXRhJyBpbiBza2VsZXRvbkRhdGFPckNvbmZpZ3VyYXRpb24pKSB7XG5cdFx0XHRjb25zdCBtYXRlcmlhbEZhY3RvcnkgPSAoKSA9PiB7XG5cdFx0XHRcdGNvbnN0IHBhcmFtZXRlcnM6IFRIUkVFLk1hdGVyaWFsUGFyYW1ldGVycyA9IHsgLi4uU2tlbGV0b25NZXNoLkRFRkFVTFRfTUFURVJJQUxfUEFSQU1FVEVSUyB9O1xuXHRcdFx0XHRtYXRlcmlhbEN1c3RvbWl6ZXIocGFyYW1ldGVycyk7XG5cdFx0XHRcdHJldHVybiBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwocGFyYW1ldGVycyk7XG5cdFx0XHR9O1xuXHRcdFx0c2tlbGV0b25EYXRhT3JDb25maWd1cmF0aW9uID0ge1xuXHRcdFx0XHRza2VsZXRvbkRhdGE6IHNrZWxldG9uRGF0YU9yQ29uZmlndXJhdGlvbixcblx0XHRcdFx0bWF0ZXJpYWxGYWN0b3J5LFxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHRoaXMudHdvQ29sb3JUaW50ID0gc2tlbGV0b25EYXRhT3JDb25maWd1cmF0aW9uLnR3b0NvbG9yVGludCA/PyB0cnVlO1xuXHRcdGlmICh0aGlzLnR3b0NvbG9yVGludCkge1xuXHRcdFx0dGhpcy52ZXJ0ZXhTaXplICs9IDQ7XG5cdFx0fVxuXG5cdFx0dGhpcy5tYXRlcmlhbEZhY3RvcnkgPSBza2VsZXRvbkRhdGFPckNvbmZpZ3VyYXRpb24ubWF0ZXJpYWxGYWN0b3J5ID8/ICgoKSA9PiBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoU2tlbGV0b25NZXNoLkRFRkFVTFRfTUFURVJJQUxfUEFSQU1FVEVSUykpO1xuXHRcdHRoaXMuc2tlbGV0b24gPSBuZXcgU2tlbGV0b24oc2tlbGV0b25EYXRhT3JDb25maWd1cmF0aW9uLnNrZWxldG9uRGF0YSk7XG5cdFx0bGV0IGFuaW1EYXRhID0gbmV3IEFuaW1hdGlvblN0YXRlRGF0YShza2VsZXRvbkRhdGFPckNvbmZpZ3VyYXRpb24uc2tlbGV0b25EYXRhKTtcblx0XHR0aGlzLnN0YXRlID0gbmV3IEFuaW1hdGlvblN0YXRlKGFuaW1EYXRhKTtcblxuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAnY2FzdFNoYWRvdycsIHtcblx0XHRcdGdldDogKCkgPT4gdGhpcy5fY2FzdFNoYWRvdyxcblx0XHRcdHNldDogKHZhbHVlOiBib29sZWFuKSA9PiB7XG5cdFx0XHRcdHRoaXMuX2Nhc3RTaGFkb3cgPSB2YWx1ZTtcblx0XHRcdFx0dGhpcy50cmF2ZXJzZSgoY2hpbGQpID0+IHtcblx0XHRcdFx0XHRpZiAoY2hpbGQgaW5zdGFuY2VvZiBNZXNoQmF0Y2hlcikge1xuXHRcdFx0XHRcdFx0Y2hpbGQuY2FzdFNoYWRvdyA9IHZhbHVlO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9LFxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICdyZWNlaXZlU2hhZG93Jywge1xuXHRcdFx0Z2V0OiAoKSA9PiB0aGlzLl9yZWNlaXZlU2hhZG93LFxuXHRcdFx0c2V0OiAodmFsdWU6IGJvb2xlYW4pID0+IHtcblx0XHRcdFx0dGhpcy5fcmVjZWl2ZVNoYWRvdyA9IHZhbHVlO1xuXHRcdFx0XHQvLyBQcm9wYWdhdGUgdG8gY2hpbGRyZW5cblx0XHRcdFx0dGhpcy50cmF2ZXJzZSgoY2hpbGQpID0+IHtcblx0XHRcdFx0XHRpZiAoY2hpbGQgaW5zdGFuY2VvZiBNZXNoQmF0Y2hlcikge1xuXHRcdFx0XHRcdFx0Y2hpbGQucmVjZWl2ZVNoYWRvdyA9IHZhbHVlO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9LFxuXHRcdH0pO1xuXHR9XG5cblx0dXBkYXRlIChkZWx0YVRpbWU6IG51bWJlcikge1xuXHRcdGxldCBzdGF0ZSA9IHRoaXMuc3RhdGU7XG5cdFx0bGV0IHNrZWxldG9uID0gdGhpcy5za2VsZXRvbjtcblxuXHRcdHN0YXRlLnVwZGF0ZShkZWx0YVRpbWUpO1xuXHRcdHN0YXRlLmFwcGx5KHNrZWxldG9uKTtcblx0XHRza2VsZXRvbi51cGRhdGUoZGVsdGFUaW1lKTtcblx0XHRza2VsZXRvbi51cGRhdGVXb3JsZFRyYW5zZm9ybShQaHlzaWNzLnVwZGF0ZSk7XG5cblx0XHR0aGlzLnVwZGF0ZUdlb21ldHJ5KCk7XG5cdH1cblxuXHRkaXNwb3NlICgpIHtcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuYmF0Y2hlcy5sZW5ndGg7IGkrKykge1xuXHRcdFx0dGhpcy5iYXRjaGVzW2ldLmRpc3Bvc2UoKTtcblx0XHR9XG5cdH1cblxuXHRwcml2YXRlIGNsZWFyQmF0Y2hlcyAoKSB7XG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmJhdGNoZXMubGVuZ3RoOyBpKyspIHtcblx0XHRcdHRoaXMuYmF0Y2hlc1tpXS5jbGVhcigpO1xuXHRcdFx0dGhpcy5iYXRjaGVzW2ldLnZpc2libGUgPSBmYWxzZTtcblx0XHR9XG5cdFx0dGhpcy5uZXh0QmF0Y2hJbmRleCA9IDA7XG5cdH1cblxuXHRwcml2YXRlIG5leHRCYXRjaCAoKSB7XG5cdFx0aWYgKHRoaXMuYmF0Y2hlcy5sZW5ndGggPT0gdGhpcy5uZXh0QmF0Y2hJbmRleCkge1xuXHRcdFx0bGV0IGJhdGNoID0gbmV3IE1lc2hCYXRjaGVyKE1lc2hCYXRjaGVyLk1BWF9WRVJUSUNFUywgdGhpcy5tYXRlcmlhbEZhY3RvcnksIHRoaXMudHdvQ29sb3JUaW50KTtcblx0XHRcdGJhdGNoLmNhc3RTaGFkb3cgPSB0aGlzLl9jYXN0U2hhZG93O1xuXHRcdFx0YmF0Y2gucmVjZWl2ZVNoYWRvdyA9IHRoaXMuX3JlY2VpdmVTaGFkb3c7XG5cdFx0XHR0aGlzLmFkZChiYXRjaCk7XG5cdFx0XHR0aGlzLmJhdGNoZXMucHVzaChiYXRjaCk7XG5cdFx0fVxuXHRcdGxldCBiYXRjaCA9IHRoaXMuYmF0Y2hlc1t0aGlzLm5leHRCYXRjaEluZGV4KytdO1xuXHRcdGJhdGNoLnZpc2libGUgPSB0cnVlO1xuXHRcdHJldHVybiBiYXRjaDtcblx0fVxuXG5cdHByaXZhdGUgdXBkYXRlR2VvbWV0cnkgKCkge1xuXHRcdHRoaXMuY2xlYXJCYXRjaGVzKCk7XG5cblx0XHRsZXQgdGVtcExpZ2h0ID0gdGhpcy50ZW1wTGlnaHQ7XG5cdFx0bGV0IHRlbXBEYXJrID0gdGhpcy50ZW1wRGFyaztcblx0XHRsZXQgY2xpcHBlciA9IHRoaXMuY2xpcHBlcjtcblxuXHRcdGxldCB2ZXJ0aWNlczogTnVtYmVyQXJyYXlMaWtlID0gdGhpcy52ZXJ0aWNlcztcblx0XHRsZXQgdHJpYW5nbGVzOiBBcnJheTxudW1iZXI+IHwgbnVsbCA9IG51bGw7XG5cdFx0bGV0IHV2czogTnVtYmVyQXJyYXlMaWtlIHwgbnVsbCA9IG51bGw7XG5cdFx0bGV0IGRyYXdPcmRlciA9IHRoaXMuc2tlbGV0b24uZHJhd09yZGVyO1xuXHRcdGxldCBiYXRjaCA9IHRoaXMubmV4dEJhdGNoKCk7XG5cdFx0YmF0Y2guYmVnaW4oKTtcblx0XHRsZXQgeiA9IDA7XG5cdFx0bGV0IHpPZmZzZXQgPSB0aGlzLnpPZmZzZXQ7XG5cdFx0Zm9yIChsZXQgaSA9IDAsIG4gPSBkcmF3T3JkZXIubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XG5cdFx0XHRsZXQgdmVydGV4U2l6ZSA9IGNsaXBwZXIuaXNDbGlwcGluZygpID8gMiA6IHRoaXMudmVydGV4U2l6ZTtcblx0XHRcdGxldCBzbG90ID0gZHJhd09yZGVyW2ldO1xuXHRcdFx0aWYgKCFzbG90LmJvbmUuYWN0aXZlKSB7XG5cdFx0XHRcdGNsaXBwZXIuY2xpcEVuZFdpdGhTbG90KHNsb3QpO1xuXHRcdFx0XHRjb250aW51ZTtcblx0XHRcdH1cblx0XHRcdGxldCBhdHRhY2htZW50ID0gc2xvdC5nZXRBdHRhY2htZW50KCk7XG5cdFx0XHRsZXQgYXR0YWNobWVudENvbG9yOiBDb2xvciB8IG51bGw7XG5cdFx0XHRsZXQgdGV4dHVyZTogVGhyZWVKc1RleHR1cmUgfCBudWxsO1xuXHRcdFx0bGV0IG51bUZsb2F0cyA9IDA7XG5cdFx0XHRpZiAoYXR0YWNobWVudCBpbnN0YW5jZW9mIFJlZ2lvbkF0dGFjaG1lbnQpIHtcblx0XHRcdFx0bGV0IHJlZ2lvbiA9IDxSZWdpb25BdHRhY2htZW50PmF0dGFjaG1lbnQ7XG5cdFx0XHRcdGF0dGFjaG1lbnRDb2xvciA9IHJlZ2lvbi5jb2xvcjtcblx0XHRcdFx0dmVydGljZXMgPSB0aGlzLnZlcnRpY2VzO1xuXHRcdFx0XHRudW1GbG9hdHMgPSB2ZXJ0ZXhTaXplICogNDtcblx0XHRcdFx0cmVnaW9uLmNvbXB1dGVXb3JsZFZlcnRpY2VzKHNsb3QsIHZlcnRpY2VzLCAwLCB2ZXJ0ZXhTaXplKTtcblx0XHRcdFx0dHJpYW5nbGVzID0gU2tlbGV0b25NZXNoLlFVQURfVFJJQU5HTEVTO1xuXHRcdFx0XHR1dnMgPSByZWdpb24udXZzO1xuXHRcdFx0XHR0ZXh0dXJlID0gPFRocmVlSnNUZXh0dXJlPnJlZ2lvbi5yZWdpb24hLnRleHR1cmU7XG5cdFx0XHR9IGVsc2UgaWYgKGF0dGFjaG1lbnQgaW5zdGFuY2VvZiBNZXNoQXR0YWNobWVudCkge1xuXHRcdFx0XHRsZXQgbWVzaCA9IDxNZXNoQXR0YWNobWVudD5hdHRhY2htZW50O1xuXHRcdFx0XHRhdHRhY2htZW50Q29sb3IgPSBtZXNoLmNvbG9yO1xuXHRcdFx0XHR2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7XG5cdFx0XHRcdG51bUZsb2F0cyA9IChtZXNoLndvcmxkVmVydGljZXNMZW5ndGggPj4gMSkgKiB2ZXJ0ZXhTaXplO1xuXHRcdFx0XHRpZiAobnVtRmxvYXRzID4gdmVydGljZXMubGVuZ3RoKSB7XG5cdFx0XHRcdFx0dmVydGljZXMgPSB0aGlzLnZlcnRpY2VzID0gVXRpbHMubmV3RmxvYXRBcnJheShudW1GbG9hdHMpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdG1lc2guY29tcHV0ZVdvcmxkVmVydGljZXMoXG5cdFx0XHRcdFx0c2xvdCxcblx0XHRcdFx0XHQwLFxuXHRcdFx0XHRcdG1lc2gud29ybGRWZXJ0aWNlc0xlbmd0aCxcblx0XHRcdFx0XHR2ZXJ0aWNlcyxcblx0XHRcdFx0XHQwLFxuXHRcdFx0XHRcdHZlcnRleFNpemVcblx0XHRcdFx0KTtcblx0XHRcdFx0dHJpYW5nbGVzID0gbWVzaC50cmlhbmdsZXM7XG5cdFx0XHRcdHV2cyA9IG1lc2gudXZzO1xuXHRcdFx0XHR0ZXh0dXJlID0gPFRocmVlSnNUZXh0dXJlPm1lc2gucmVnaW9uIS50ZXh0dXJlO1xuXHRcdFx0fSBlbHNlIGlmIChhdHRhY2htZW50IGluc3RhbmNlb2YgQ2xpcHBpbmdBdHRhY2htZW50KSB7XG5cdFx0XHRcdGxldCBjbGlwID0gPENsaXBwaW5nQXR0YWNobWVudD5hdHRhY2htZW50O1xuXHRcdFx0XHRjbGlwcGVyLmNsaXBTdGFydChzbG90LCBjbGlwKTtcblx0XHRcdFx0Y29udGludWU7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjbGlwcGVyLmNsaXBFbmRXaXRoU2xvdChzbG90KTtcblx0XHRcdFx0Y29udGludWU7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0ZXh0dXJlICE9IG51bGwpIHtcblx0XHRcdFx0bGV0IHNrZWxldG9uID0gc2xvdC5ib25lLnNrZWxldG9uO1xuXHRcdFx0XHRsZXQgc2tlbGV0b25Db2xvciA9IHNrZWxldG9uLmNvbG9yO1xuXHRcdFx0XHRsZXQgc2xvdENvbG9yID0gc2xvdC5jb2xvcjtcblx0XHRcdFx0bGV0IGFscGhhID0gc2tlbGV0b25Db2xvci5hICogc2xvdENvbG9yLmEgKiBhdHRhY2htZW50Q29sb3IuYTtcblx0XHRcdFx0bGV0IGNvbG9yID0gdGhpcy50ZW1wQ29sb3I7XG5cdFx0XHRcdGNvbG9yLnNldChcblx0XHRcdFx0XHRza2VsZXRvbkNvbG9yLnIgKiBzbG90Q29sb3IuciAqIGF0dGFjaG1lbnRDb2xvci5yICogYWxwaGEsXG5cdFx0XHRcdFx0c2tlbGV0b25Db2xvci5nICogc2xvdENvbG9yLmcgKiBhdHRhY2htZW50Q29sb3IuZyAqIGFscGhhLFxuXHRcdFx0XHRcdHNrZWxldG9uQ29sb3IuYiAqIHNsb3RDb2xvci5iICogYXR0YWNobWVudENvbG9yLmIgKiBhbHBoYSxcblx0XHRcdFx0XHRhbHBoYVxuXHRcdFx0XHQpO1xuXG5cdFx0XHRcdGxldCBkYXJrQ29sb3IgPSB0aGlzLnRlbXBEYXJrQ29sb3I7XG5cdFx0XHRcdGlmICghc2xvdC5kYXJrQ29sb3IpXG5cdFx0XHRcdFx0ZGFya0NvbG9yLnNldCgwLCAwLCAwLCAxKTtcblx0XHRcdFx0ZWxzZSB7XG5cdFx0XHRcdFx0ZGFya0NvbG9yLnIgPSBzbG90LmRhcmtDb2xvci5yICogYWxwaGE7XG5cdFx0XHRcdFx0ZGFya0NvbG9yLmcgPSBzbG90LmRhcmtDb2xvci5nICogYWxwaGE7XG5cdFx0XHRcdFx0ZGFya0NvbG9yLmIgPSBzbG90LmRhcmtDb2xvci5iICogYWxwaGE7XG5cdFx0XHRcdFx0ZGFya0NvbG9yLmEgPSAxO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0bGV0IGZpbmFsVmVydGljZXM6IE51bWJlckFycmF5TGlrZTtcblx0XHRcdFx0bGV0IGZpbmFsVmVydGljZXNMZW5ndGg6IG51bWJlcjtcblx0XHRcdFx0bGV0IGZpbmFsSW5kaWNlczogTnVtYmVyQXJyYXlMaWtlO1xuXHRcdFx0XHRsZXQgZmluYWxJbmRpY2VzTGVuZ3RoOiBudW1iZXI7XG5cblx0XHRcdFx0aWYgKGNsaXBwZXIuaXNDbGlwcGluZygpKSB7XG5cdFx0XHRcdFx0Y2xpcHBlci5jbGlwVHJpYW5nbGVzKFxuXHRcdFx0XHRcdFx0dmVydGljZXMsXG5cdFx0XHRcdFx0XHR0cmlhbmdsZXMsXG5cdFx0XHRcdFx0XHR0cmlhbmdsZXMubGVuZ3RoLFxuXHRcdFx0XHRcdFx0dXZzLFxuXHRcdFx0XHRcdFx0Y29sb3IsXG5cdFx0XHRcdFx0XHR0ZW1wTGlnaHQsXG5cdFx0XHRcdFx0XHR0aGlzLnR3b0NvbG9yVGludCxcblx0XHRcdFx0XHQpO1xuXHRcdFx0XHRcdGxldCBjbGlwcGVkVmVydGljZXMgPSBjbGlwcGVyLmNsaXBwZWRWZXJ0aWNlcztcblx0XHRcdFx0XHRsZXQgY2xpcHBlZFRyaWFuZ2xlcyA9IGNsaXBwZXIuY2xpcHBlZFRyaWFuZ2xlcztcblx0XHRcdFx0XHRmaW5hbFZlcnRpY2VzID0gY2xpcHBlZFZlcnRpY2VzO1xuXHRcdFx0XHRcdGZpbmFsVmVydGljZXNMZW5ndGggPSBjbGlwcGVkVmVydGljZXMubGVuZ3RoO1xuXHRcdFx0XHRcdGZpbmFsSW5kaWNlcyA9IGNsaXBwZWRUcmlhbmdsZXM7XG5cdFx0XHRcdFx0ZmluYWxJbmRpY2VzTGVuZ3RoID0gY2xpcHBlZFRyaWFuZ2xlcy5sZW5ndGg7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0bGV0IHZlcnRzID0gdmVydGljZXM7XG5cdFx0XHRcdFx0aWYgKCF0aGlzLnR3b0NvbG9yVGludCkge1xuXHRcdFx0XHRcdFx0Zm9yIChsZXQgdiA9IDIsIHUgPSAwLCBuID0gbnVtRmxvYXRzOyB2IDwgbjsgdiArPSB2ZXJ0ZXhTaXplLCB1ICs9IDIpIHtcblx0XHRcdFx0XHRcdFx0dmVydHNbdl0gPSBjb2xvci5yO1xuXHRcdFx0XHRcdFx0XHR2ZXJ0c1t2ICsgMV0gPSBjb2xvci5nO1xuXHRcdFx0XHRcdFx0XHR2ZXJ0c1t2ICsgMl0gPSBjb2xvci5iO1xuXHRcdFx0XHRcdFx0XHR2ZXJ0c1t2ICsgM10gPSBjb2xvci5hO1xuXHRcdFx0XHRcdFx0XHR2ZXJ0c1t2ICsgNF0gPSB1dnNbdV07XG5cdFx0XHRcdFx0XHRcdHZlcnRzW3YgKyA1XSA9IHV2c1t1ICsgMV07XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGZvciAobGV0IHYgPSAyLCB1ID0gMCwgbiA9IG51bUZsb2F0czsgdiA8IG47IHYgKz0gdmVydGV4U2l6ZSwgdSArPSAyKSB7XG5cdFx0XHRcdFx0XHRcdHZlcnRzW3ZdID0gY29sb3Iucjtcblx0XHRcdFx0XHRcdFx0dmVydHNbdiArIDFdID0gY29sb3IuZztcblx0XHRcdFx0XHRcdFx0dmVydHNbdiArIDJdID0gY29sb3IuYjtcblx0XHRcdFx0XHRcdFx0dmVydHNbdiArIDNdID0gY29sb3IuYTtcblx0XHRcdFx0XHRcdFx0dmVydHNbdiArIDRdID0gdXZzW3VdO1xuXHRcdFx0XHRcdFx0XHR2ZXJ0c1t2ICsgNV0gPSB1dnNbdSArIDFdO1xuXHRcdFx0XHRcdFx0XHR2ZXJ0c1t2ICsgNl0gPSBkYXJrQ29sb3Iucjtcblx0XHRcdFx0XHRcdFx0dmVydHNbdiArIDddID0gZGFya0NvbG9yLmc7XG5cdFx0XHRcdFx0XHRcdHZlcnRzW3YgKyA4XSA9IGRhcmtDb2xvci5iO1xuXHRcdFx0XHRcdFx0XHR2ZXJ0c1t2ICsgOV0gPSBkYXJrQ29sb3IuYTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRmaW5hbFZlcnRpY2VzID0gdmVydGljZXM7XG5cdFx0XHRcdFx0ZmluYWxWZXJ0aWNlc0xlbmd0aCA9IG51bUZsb2F0cztcblx0XHRcdFx0XHRmaW5hbEluZGljZXMgPSB0cmlhbmdsZXM7XG5cdFx0XHRcdFx0ZmluYWxJbmRpY2VzTGVuZ3RoID0gdHJpYW5nbGVzLmxlbmd0aDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChmaW5hbFZlcnRpY2VzTGVuZ3RoID09IDAgfHwgZmluYWxJbmRpY2VzTGVuZ3RoID09IDApIHtcblx0XHRcdFx0XHRjbGlwcGVyLmNsaXBFbmRXaXRoU2xvdChzbG90KTtcblx0XHRcdFx0XHRjb250aW51ZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIFN0YXJ0IG5ldyBiYXRjaCBpZiB0aGlzIG9uZSBjYW4ndCBob2xkIHZlcnRpY2VzL2luZGljZXNcblx0XHRcdFx0aWYgKFxuXHRcdFx0XHRcdCFiYXRjaC5jYW5CYXRjaChcblx0XHRcdFx0XHRcdGZpbmFsVmVydGljZXNMZW5ndGggLyB0aGlzLnZlcnRleFNpemUsXG5cdFx0XHRcdFx0XHRmaW5hbEluZGljZXNMZW5ndGhcblx0XHRcdFx0XHQpXG5cdFx0XHRcdCkge1xuXHRcdFx0XHRcdGJhdGNoLmVuZCgpO1xuXHRcdFx0XHRcdGJhdGNoID0gdGhpcy5uZXh0QmF0Y2goKTtcblx0XHRcdFx0XHRiYXRjaC5iZWdpbigpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Y29uc3Qgc2xvdEJsZW5kTW9kZSA9IHNsb3QuZGF0YS5ibGVuZE1vZGU7XG5cdFx0XHRcdGNvbnN0IHNsb3RUZXh0dXJlID0gdGV4dHVyZS50ZXh0dXJlO1xuXHRcdFx0XHRjb25zdCBtYXRlcmlhbEdyb3VwID0gYmF0Y2guZmluZE1hdGVyaWFsR3JvdXAoXG5cdFx0XHRcdFx0c2xvdFRleHR1cmUsXG5cdFx0XHRcdFx0c2xvdEJsZW5kTW9kZVxuXHRcdFx0XHQpO1xuXG5cdFx0XHRcdGJhdGNoLmFkZE1hdGVyaWFsR3JvdXAoZmluYWxJbmRpY2VzTGVuZ3RoLCBtYXRlcmlhbEdyb3VwKTtcblx0XHRcdFx0YmF0Y2guYmF0Y2goXG5cdFx0XHRcdFx0ZmluYWxWZXJ0aWNlcyxcblx0XHRcdFx0XHRmaW5hbFZlcnRpY2VzTGVuZ3RoLFxuXHRcdFx0XHRcdGZpbmFsSW5kaWNlcyxcblx0XHRcdFx0XHRmaW5hbEluZGljZXNMZW5ndGgsXG5cdFx0XHRcdFx0elxuXHRcdFx0XHQpO1xuXHRcdFx0XHR6ICs9IHpPZmZzZXQ7XG5cdFx0XHR9XG5cblx0XHRcdGNsaXBwZXIuY2xpcEVuZFdpdGhTbG90KHNsb3QpO1xuXHRcdH1cblx0XHRjbGlwcGVyLmNsaXBFbmQoKTtcblx0XHRiYXRjaC5lbmQoKTtcblx0fVxufVxuIl19