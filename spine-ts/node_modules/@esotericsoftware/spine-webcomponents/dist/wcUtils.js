/******************************************************************************
 * Spine Runtimes License Agreement
 * Last updated July 28, 2023. Replaces all prior versions.
 *
 * Copyright (c) 2013-2023, Esoteric Software LLC
 *
 * Integration of the Spine Runtimes into software or otherwise creating
 * derivative works of the Spine Runtimes is permitted under the terms and
 * conditions of Section 2 of the Spine Editor License Agreement:
 * http://esotericsoftware.com/spine-editor-license
 *
 * Otherwise, it is permitted to integrate the Spine Runtimes into software or
 * otherwise create derivative works of the Spine Runtimes (collectively,
 * "Products"), provided that each user of the Products must obtain their own
 * Spine Editor license and redistribution of the Products in any form must
 * include this license and copyright notice.
 *
 * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,
 * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THE
 * SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************/
const animatonTypeRegExp = /\[([^\]]+)\]/g;
export function castValue(type, value, defaultValue) {
    switch (type) {
        case "string":
            return castString(value, defaultValue);
        case "number":
            return castNumber(value, defaultValue);
        case "boolean":
            return castBoolean(value, defaultValue);
        case "array-number":
            return castArrayNumber(value, defaultValue);
        case "array-string":
            return castArrayString(value, defaultValue);
        case "object":
            return castObject(value, defaultValue);
        case "fitType":
            return isFitType(value) ? value : defaultValue;
        case "offScreenUpdateBehaviourType":
            return isOffScreenUpdateBehaviourType(value) ? value : defaultValue;
        case "animationsInfo":
            return castToAnimationsInfo(value) || defaultValue;
        default:
            break;
    }
}
function castBoolean(value, defaultValue = "") {
    return value === "true" || value === "" ? true : false;
}
function castString(value, defaultValue = "") {
    return value === null ? defaultValue : value;
}
function castNumber(value, defaultValue = 0) {
    if (value === null)
        return defaultValue;
    const parsed = parseFloat(value);
    if (Number.isNaN(parsed))
        return defaultValue;
    return parsed;
}
function castArrayNumber(value, defaultValue = undefined) {
    if (value === null)
        return defaultValue;
    return value.split(",").reduce((acc, pageIndex) => {
        const index = parseInt(pageIndex);
        if (!isNaN(index))
            acc.push(index);
        return acc;
    }, []);
}
function castArrayString(value, defaultValue = undefined) {
    if (value === null)
        return defaultValue;
    return value.split(",");
}
function castObject(value, defaultValue = undefined) {
    if (value === null)
        return null;
    return JSON.parse(value);
}
function castToAnimationsInfo(value) {
    if (value === null) {
        return undefined;
    }
    const matches = value.match(animatonTypeRegExp);
    if (!matches)
        return undefined;
    return matches.reduce((obj, group) => {
        const [trackIndexStringOrLoopDefinition, animationNameOrTrackIndexStringCycle, loopOrRepeatDelay, delayString, mixDurationString] = group.slice(1, -1).split(',').map(v => v.trim());
        if (trackIndexStringOrLoopDefinition === "loop") {
            if (!Number.isInteger(Number(animationNameOrTrackIndexStringCycle))) {
                throw new Error(`Track index of cycle in ${group} must be a positive integer number, instead it is ${animationNameOrTrackIndexStringCycle}. Original value: ${value}`);
            }
            const animationInfoObject = obj[animationNameOrTrackIndexStringCycle] ||= { animations: [] };
            animationInfoObject.cycle = true;
            if (loopOrRepeatDelay !== undefined) {
                const repeatDelay = Number(loopOrRepeatDelay);
                if (Number.isNaN(repeatDelay)) {
                    throw new Error(`If present, duration of last animation of cycle in ${group} must be a positive integer number, instead it is ${loopOrRepeatDelay}. Original value: ${value}`);
                }
                animationInfoObject.repeatDelay = repeatDelay;
            }
            return obj;
        }
        const trackIndex = Number(trackIndexStringOrLoopDefinition);
        if (!Number.isInteger(trackIndex)) {
            throw new Error(`Track index in ${group} must be a positive integer number, instead it is ${trackIndexStringOrLoopDefinition}. Original value: ${value}`);
        }
        let delay;
        if (delayString !== undefined) {
            delay = parseFloat(delayString);
            if (isNaN(delay)) {
                throw new Error(`Delay in ${group} must be a positive number, instead it is ${delayString}. Original value: ${value}`);
            }
        }
        let mixDuration;
        if (mixDurationString !== undefined) {
            mixDuration = parseFloat(mixDurationString);
            if (isNaN(mixDuration)) {
                throw new Error(`mixDuration in ${group} must be a positive number, instead it is ${mixDurationString}. Original value: ${value}`);
            }
        }
        const animationInfoObject = obj[trackIndexStringOrLoopDefinition] ||= { animations: [] };
        animationInfoObject.animations.push({
            animationName: animationNameOrTrackIndexStringCycle,
            loop: (loopOrRepeatDelay || "").trim().toLowerCase() === "true",
            delay,
            mixDuration,
        });
        return obj;
    }, {});
}
function isFitType(value) {
    return (value === "fill" ||
        value === "width" ||
        value === "height" ||
        value === "contain" ||
        value === "cover" ||
        value === "none" ||
        value === "scaleDown" ||
        value === "origin");
}
function isOffScreenUpdateBehaviourType(value) {
    return (value === "pause" ||
        value === "update" ||
        value === "pose");
}
const base64RegExp = /^(([A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{4}|[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==))$/;
export function isBase64(str) {
    return base64RegExp.test(str);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2NVdGlscy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy93Y1V0aWxzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7K0VBMkIrRTtBQUkvRSxNQUFNLGtCQUFrQixHQUFHLGVBQWUsQ0FBQztBQUczQyxNQUFNLFVBQVUsU0FBUyxDQUFFLElBQW9CLEVBQUUsS0FBb0IsRUFBRSxZQUFrQjtJQUN4RixRQUFRLElBQUksRUFBRSxDQUFDO1FBQ2QsS0FBSyxRQUFRO1lBQ1osT0FBTyxVQUFVLENBQUMsS0FBSyxFQUFFLFlBQVksQ0FBQyxDQUFDO1FBQ3hDLEtBQUssUUFBUTtZQUNaLE9BQU8sVUFBVSxDQUFDLEtBQUssRUFBRSxZQUFZLENBQUMsQ0FBQztRQUN4QyxLQUFLLFNBQVM7WUFDYixPQUFPLFdBQVcsQ0FBQyxLQUFLLEVBQUUsWUFBWSxDQUFDLENBQUM7UUFDekMsS0FBSyxjQUFjO1lBQ2xCLE9BQU8sZUFBZSxDQUFDLEtBQUssRUFBRSxZQUFZLENBQUMsQ0FBQztRQUM3QyxLQUFLLGNBQWM7WUFDbEIsT0FBTyxlQUFlLENBQUMsS0FBSyxFQUFFLFlBQVksQ0FBQyxDQUFDO1FBQzdDLEtBQUssUUFBUTtZQUNaLE9BQU8sVUFBVSxDQUFDLEtBQUssRUFBRSxZQUFZLENBQUMsQ0FBQztRQUN4QyxLQUFLLFNBQVM7WUFDYixPQUFPLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUM7UUFDaEQsS0FBSyw4QkFBOEI7WUFDbEMsT0FBTyw4QkFBOEIsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUM7UUFDckUsS0FBSyxnQkFBZ0I7WUFDcEIsT0FBTyxvQkFBb0IsQ0FBQyxLQUFLLENBQUMsSUFBSSxZQUFZLENBQUM7UUFDcEQ7WUFDQyxNQUFNO0lBQ1IsQ0FB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Q0FBQztBQUNILENBQUM7QUFFRCxNQUFNLFlBQVksR0FBRyxnRkFBZ0YsQ0FBQztBQUN0RyxNQUFNLFVBQVUsUUFBUSxDQUFFLEdBQVc7SUFDcEMsT0FBTyxZQUFZLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQy9CLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gKiBTcGluZSBSdW50aW1lcyBMaWNlbnNlIEFncmVlbWVudFxuICogTGFzdCB1cGRhdGVkIEp1bHkgMjgsIDIwMjMuIFJlcGxhY2VzIGFsbCBwcmlvciB2ZXJzaW9ucy5cbiAqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAyMywgRXNvdGVyaWMgU29mdHdhcmUgTExDXG4gKlxuICogSW50ZWdyYXRpb24gb2YgdGhlIFNwaW5lIFJ1bnRpbWVzIGludG8gc29mdHdhcmUgb3Igb3RoZXJ3aXNlIGNyZWF0aW5nXG4gKiBkZXJpdmF0aXZlIHdvcmtzIG9mIHRoZSBTcGluZSBSdW50aW1lcyBpcyBwZXJtaXR0ZWQgdW5kZXIgdGhlIHRlcm1zIGFuZFxuICogY29uZGl0aW9ucyBvZiBTZWN0aW9uIDIgb2YgdGhlIFNwaW5lIEVkaXRvciBMaWNlbnNlIEFncmVlbWVudDpcbiAqIGh0dHA6Ly9lc290ZXJpY3NvZnR3YXJlLmNvbS9zcGluZS1lZGl0b3ItbGljZW5zZVxuICpcbiAqIE90aGVyd2lzZSwgaXQgaXMgcGVybWl0dGVkIHRvIGludGVncmF0ZSB0aGUgU3BpbmUgUnVudGltZXMgaW50byBzb2Z0d2FyZSBvclxuICogb3RoZXJ3aXNlIGNyZWF0ZSBkZXJpdmF0aXZlIHdvcmtzIG9mIHRoZSBTcGluZSBSdW50aW1lcyAoY29sbGVjdGl2ZWx5LFxuICogXCJQcm9kdWN0c1wiKSwgcHJvdmlkZWQgdGhhdCBlYWNoIHVzZXIgb2YgdGhlIFByb2R1Y3RzIG11c3Qgb2J0YWluIHRoZWlyIG93blxuICogU3BpbmUgRWRpdG9yIGxpY2Vuc2UgYW5kIHJlZGlzdHJpYnV0aW9uIG9mIHRoZSBQcm9kdWN0cyBpbiBhbnkgZm9ybSBtdXN0XG4gKiBpbmNsdWRlIHRoaXMgbGljZW5zZSBhbmQgY29weXJpZ2h0IG5vdGljZS5cbiAqXG4gKiBUSEUgU1BJTkUgUlVOVElNRVMgQVJFIFBST1ZJREVEIEJZIEVTT1RFUklDIFNPRlRXQVJFIExMQyBcIkFTIElTXCIgQU5EIEFOWVxuICogRVhQUkVTUyBPUiBJTVBMSUVEIFdBUlJBTlRJRVMsIElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBUSEUgSU1QTElFRFxuICogV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFSRVxuICogRElTQ0xBSU1FRC4gSU4gTk8gRVZFTlQgU0hBTEwgRVNPVEVSSUMgU09GVFdBUkUgTExDIEJFIExJQUJMRSBGT1IgQU5ZXG4gKiBESVJFQ1QsIElORElSRUNULCBJTkNJREVOVEFMLCBTUEVDSUFMLCBFWEVNUExBUlksIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFU1xuICogKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTLFxuICogQlVTSU5FU1MgSU5URVJSVVBUSU9OLCBPUiBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUykgSE9XRVZFUiBDQVVTRUQgQU5EXG4gKiBPTiBBTlkgVEhFT1JZIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUIExJQUJJTElUWSwgT1IgVE9SVFxuICogKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkgQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFIE9GIFRIRVxuICogU1BJTkUgUlVOVElNRVMsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUgUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5cbmltcG9ydCB7IEFuaW1hdGlvbnNJbmZvLCBGaXRUeXBlLCBPZmZTY3JlZW5VcGRhdGVCZWhhdmlvdXJUeXBlIH0gZnJvbSBcIi4vU3BpbmVXZWJDb21wb25lbnRTa2VsZXRvbi5qc1wiO1xuXG5jb25zdCBhbmltYXRvblR5cGVSZWdFeHAgPSAvXFxbKFteXFxdXSspXFxdL2c7XG5leHBvcnQgdHlwZSBBdHRyaWJ1dGVUeXBlcyA9IFwic3RyaW5nXCIgfCBcIm51bWJlclwiIHwgXCJib29sZWFuXCIgfCBcImFycmF5LW51bWJlclwiIHwgXCJhcnJheS1zdHJpbmdcIiB8IFwib2JqZWN0XCIgfCBcImZpdFR5cGVcIiB8IFwib2ZmU2NyZWVuVXBkYXRlQmVoYXZpb3VyVHlwZVwiIHwgXCJhbmltYXRpb25zSW5mb1wiO1xuXG5leHBvcnQgZnVuY3Rpb24gY2FzdFZhbHVlICh0eXBlOiBBdHRyaWJ1dGVUeXBlcywgdmFsdWU6IHN0cmluZyB8IG51bGwsIGRlZmF1bHRWYWx1ZT86IGFueSkge1xuXHRzd2l0Y2ggKHR5cGUpIHtcblx0XHRjYXNlIFwic3RyaW5nXCI6XG5cdFx0XHRyZXR1cm4gY2FzdFN0cmluZyh2YWx1ZSwgZGVmYXVsdFZhbHVlKTtcblx0XHRjYXNlIFwibnVtYmVyXCI6XG5cdFx0XHRyZXR1cm4gY2FzdE51bWJlcih2YWx1ZSwgZGVmYXVsdFZhbHVlKTtcblx0XHRjYXNlIFwiYm9vbGVhblwiOlxuXHRcdFx0cmV0dXJuIGNhc3RCb29sZWFuKHZhbHVlLCBkZWZhdWx0VmFsdWUpO1xuXHRcdGNhc2UgXCJhcnJheS1udW1iZXJcIjpcblx0XHRcdHJldHVybiBjYXN0QXJyYXlOdW1iZXIodmFsdWUsIGRlZmF1bHRWYWx1ZSk7XG5cdFx0Y2FzZSBcImFycmF5LXN0cmluZ1wiOlxuXHRcdFx0cmV0dXJuIGNhc3RBcnJheVN0cmluZyh2YWx1ZSwgZGVmYXVsdFZhbHVlKTtcblx0XHRjYXNlIFwib2JqZWN0XCI6XG5cdFx0XHRyZXR1cm4gY2FzdE9iamVjdCh2YWx1ZSwgZGVmYXVsdFZhbHVlKTtcblx0XHRjYXNlIFwiZml0VHlwZVwiOlxuXHRcdFx0cmV0dXJuIGlzRml0VHlwZSh2YWx1ZSkgPyB2YWx1ZSA6IGRlZmF1bHRWYWx1ZTtcblx0XHRjYXNlIFwib2ZmU2NyZWVuVXBkYXRlQmVoYXZpb3VyVHlwZVwiOlxuXHRcdFx0cmV0dXJuIGlzT2ZmU2NyZWVuVXBkYXRlQmVoYXZpb3VyVHlwZSh2YWx1ZSkgPyB2YWx1ZSA6IGRlZmF1bHRWYWx1ZTtcblx0XHRjYXNlIFwiYW5pbWF0aW9uc0luZm9cIjpcblx0XHRcdHJldHVybiBjYXN0VG9BbmltYXRpb25zSW5mbyh2YWx1ZSkgfHwgZGVmYXVsdFZhbHVlO1xuXHRcdGRlZmF1bHQ6XG5cdFx0XHRicmVhaztcblx0fVxufVxuXG5mdW5jdGlvbiBjYXN0Qm9vbGVhbiAodmFsdWU6IHN0cmluZyB8IG51bGwsIGRlZmF1bHRWYWx1ZSA9IFwiXCIpIHtcblx0cmV0dXJuIHZhbHVlID09PSBcInRydWVcIiB8fCB2YWx1ZSA9PT0gXCJcIiA/IHRydWUgOiBmYWxzZTtcbn1cblxuZnVuY3Rpb24gY2FzdFN0cmluZyAodmFsdWU6IHN0cmluZyB8IG51bGwsIGRlZmF1bHRWYWx1ZSA9IFwiXCIpIHtcblx0cmV0dXJuIHZhbHVlID09PSBudWxsID8gZGVmYXVsdFZhbHVlIDogdmFsdWU7XG59XG5cbmZ1bmN0aW9uIGNhc3ROdW1iZXIgKHZhbHVlOiBzdHJpbmcgfCBudWxsLCBkZWZhdWx0VmFsdWUgPSAwKSB7XG5cdGlmICh2YWx1ZSA9PT0gbnVsbCkgcmV0dXJuIGRlZmF1bHRWYWx1ZTtcblxuXHRjb25zdCBwYXJzZWQgPSBwYXJzZUZsb2F0KHZhbHVlKTtcblx0aWYgKE51bWJlci5pc05hTihwYXJzZWQpKSByZXR1cm4gZGVmYXVsdFZhbHVlO1xuXHRyZXR1cm4gcGFyc2VkO1xufVxuXG5mdW5jdGlvbiBjYXN0QXJyYXlOdW1iZXIgKHZhbHVlOiBzdHJpbmcgfCBudWxsLCBkZWZhdWx0VmFsdWUgPSB1bmRlZmluZWQpIHtcblx0aWYgKHZhbHVlID09PSBudWxsKSByZXR1cm4gZGVmYXVsdFZhbHVlO1xuXHRyZXR1cm4gdmFsdWUuc3BsaXQoXCIsXCIpLnJlZHVjZSgoYWNjLCBwYWdlSW5kZXgpID0+IHtcblx0XHRjb25zdCBpbmRleCA9IHBhcnNlSW50KHBhZ2VJbmRleCk7XG5cdFx0aWYgKCFpc05hTihpbmRleCkpIGFjYy5wdXNoKGluZGV4KTtcblx0XHRyZXR1cm4gYWNjO1xuXHR9LCBbXSBhcyBBcnJheTxudW1iZXI+KTtcbn1cblxuZnVuY3Rpb24gY2FzdEFycmF5U3RyaW5nICh2YWx1ZTogc3RyaW5nIHwgbnVsbCwgZGVmYXVsdFZhbHVlID0gdW5kZWZpbmVkKSB7XG5cdGlmICh2YWx1ZSA9PT0gbnVsbCkgcmV0dXJuIGRlZmF1bHRWYWx1ZTtcblx0cmV0dXJuIHZhbHVlLnNwbGl0KFwiLFwiKTtcbn1cblxuZnVuY3Rpb24gY2FzdE9iamVjdCAodmFsdWU6IHN0cmluZyB8IG51bGwsIGRlZmF1bHRWYWx1ZSA9IHVuZGVmaW5lZCkge1xuXHRpZiAodmFsdWUgPT09IG51bGwpIHJldHVybiBudWxsO1xuXHRyZXR1cm4gSlNPTi5wYXJzZSh2YWx1ZSk7XG59XG5cblxuZnVuY3Rpb24gY2FzdFRvQW5pbWF0aW9uc0luZm8gKHZhbHVlOiBzdHJpbmcgfCBudWxsKTogQW5pbWF0aW9uc0luZm8gfCB1bmRlZmluZWQge1xuXHRpZiAodmFsdWUgPT09IG51bGwpIHtcblx0XHRyZXR1cm4gdW5kZWZpbmVkO1xuXHR9XG5cblx0Y29uc3QgbWF0Y2hlcyA9IHZhbHVlLm1hdGNoKGFuaW1hdG9uVHlwZVJlZ0V4cCk7XG5cdGlmICghbWF0Y2hlcykgcmV0dXJuIHVuZGVmaW5lZDtcblxuXHRyZXR1cm4gbWF0Y2hlcy5yZWR1Y2UoKG9iaiwgZ3JvdXApID0+IHtcblx0XHRjb25zdCBbdHJhY2tJbmRleFN0cmluZ09yTG9vcERlZmluaXRpb24sIGFuaW1hdGlvbk5hbWVPclRyYWNrSW5kZXhTdHJpbmdDeWNsZSwgbG9vcE9yUmVwZWF0RGVsYXksIGRlbGF5U3RyaW5nLCBtaXhEdXJhdGlvblN0cmluZ10gPSBncm91cC5zbGljZSgxLCAtMSkuc3BsaXQoJywnKS5tYXAodiA9PiB2LnRyaW0oKSk7XG5cblx0XHRpZiAodHJhY2tJbmRleFN0cmluZ09yTG9vcERlZmluaXRpb24gPT09IFwibG9vcFwiKSB7XG5cdFx0XHRpZiAoIU51bWJlci5pc0ludGVnZXIoTnVtYmVyKGFuaW1hdGlvbk5hbWVPclRyYWNrSW5kZXhTdHJpbmdDeWNsZSkpKSB7XG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihgVHJhY2sgaW5kZXggb2YgY3ljbGUgaW4gJHtncm91cH0gbXVzdCBiZSBhIHBvc2l0aXZlIGludGVnZXIgbnVtYmVyLCBpbnN0ZWFkIGl0IGlzICR7YW5pbWF0aW9uTmFtZU9yVHJhY2tJbmRleFN0cmluZ0N5Y2xlfS4gT3JpZ2luYWwgdmFsdWU6ICR7dmFsdWV9YCk7XG5cdFx0XHR9XG5cdFx0XHRjb25zdCBhbmltYXRpb25JbmZvT2JqZWN0ID0gb2JqW2FuaW1hdGlvbk5hbWVPclRyYWNrSW5kZXhTdHJpbmdDeWNsZV0gfHw9IHsgYW5pbWF0aW9uczogW10gfTtcblx0XHRcdGFuaW1hdGlvbkluZm9PYmplY3QuY3ljbGUgPSB0cnVlO1xuXG5cdFx0XHRpZiAobG9vcE9yUmVwZWF0RGVsYXkgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0XHRjb25zdCByZXBlYXREZWxheSA9IE51bWJlcihsb29wT3JSZXBlYXREZWxheSk7XG5cdFx0XHRcdGlmIChOdW1iZXIuaXNOYU4ocmVwZWF0RGVsYXkpKSB7XG5cdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKGBJZiBwcmVzZW50LCBkdXJhdGlvbiBvZiBsYXN0IGFuaW1hdGlvbiBvZiBjeWNsZSBpbiAke2dyb3VwfSBtdXN0IGJlIGEgcG9zaXRpdmUgaW50ZWdlciBudW1iZXIsIGluc3RlYWQgaXQgaXMgJHtsb29wT3JSZXBlYXREZWxheX0uIE9yaWdpbmFsIHZhbHVlOiAke3ZhbHVlfWApO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGFuaW1hdGlvbkluZm9PYmplY3QucmVwZWF0RGVsYXkgPSByZXBlYXREZWxheTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG9iajtcblx0XHR9XG5cblx0XHRjb25zdCB0cmFja0luZGV4ID0gTnVtYmVyKHRyYWNrSW5kZXhTdHJpbmdPckxvb3BEZWZpbml0aW9uKTtcblx0XHRpZiAoIU51bWJlci5pc0ludGVnZXIodHJhY2tJbmRleCkpIHtcblx0XHRcdHRocm93IG5ldyBFcnJvcihgVHJhY2sgaW5kZXggaW4gJHtncm91cH0gbXVzdCBiZSBhIHBvc2l0aXZlIGludGVnZXIgbnVtYmVyLCBpbnN0ZWFkIGl0IGlzICR7dHJhY2tJbmRleFN0cmluZ09yTG9vcERlZmluaXRpb259LiBPcmlnaW5hbCB2YWx1ZTogJHt2YWx1ZX1gKTtcblx0XHR9XG5cblx0XHRsZXQgZGVsYXk7XG5cdFx0aWYgKGRlbGF5U3RyaW5nICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGRlbGF5ID0gcGFyc2VGbG9hdChkZWxheVN0cmluZyk7XG5cdFx0XHRpZiAoaXNOYU4oZGVsYXkpKSB7XG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihgRGVsYXkgaW4gJHtncm91cH0gbXVzdCBiZSBhIHBvc2l0aXZlIG51bWJlciwgaW5zdGVhZCBpdCBpcyAke2RlbGF5U3RyaW5nfS4gT3JpZ2luYWwgdmFsdWU6ICR7dmFsdWV9YCk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0bGV0IG1peER1cmF0aW9uO1xuXHRcdGlmIChtaXhEdXJhdGlvblN0cmluZyAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRtaXhEdXJhdGlvbiA9IHBhcnNlRmxvYXQobWl4RHVyYXRpb25TdHJpbmcpO1xuXHRcdFx0aWYgKGlzTmFOKG1peER1cmF0aW9uKSkge1xuXHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoYG1peER1cmF0aW9uIGluICR7Z3JvdXB9IG11c3QgYmUgYSBwb3NpdGl2ZSBudW1iZXIsIGluc3RlYWQgaXQgaXMgJHttaXhEdXJhdGlvblN0cmluZ30uIE9yaWdpbmFsIHZhbHVlOiAke3ZhbHVlfWApO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGNvbnN0IGFuaW1hdGlvbkluZm9PYmplY3QgPSBvYmpbdHJhY2tJbmRleFN0cmluZ09yTG9vcERlZmluaXRpb25dIHx8PSB7IGFuaW1hdGlvbnM6IFtdIH07XG5cdFx0YW5pbWF0aW9uSW5mb09iamVjdC5hbmltYXRpb25zLnB1c2goe1xuXHRcdFx0YW5pbWF0aW9uTmFtZTogYW5pbWF0aW9uTmFtZU9yVHJhY2tJbmRleFN0cmluZ0N5Y2xlLFxuXHRcdFx0bG9vcDogKGxvb3BPclJlcGVhdERlbGF5IHx8IFwiXCIpLnRyaW0oKS50b0xvd2VyQ2FzZSgpID09PSBcInRydWVcIixcblx0XHRcdGRlbGF5LFxuXHRcdFx0bWl4RHVyYXRpb24sXG5cdFx0fSk7XG5cdFx0cmV0dXJuIG9iajtcblx0fSwge30gYXMgQW5pbWF0aW9uc0luZm8pO1xufVxuXG5mdW5jdGlvbiBpc0ZpdFR5cGUgKHZhbHVlOiBzdHJpbmcgfCBudWxsKTogdmFsdWUgaXMgRml0VHlwZSB7XG5cdHJldHVybiAoXG5cdFx0dmFsdWUgPT09IFwiZmlsbFwiIHx8XG5cdFx0dmFsdWUgPT09IFwid2lkdGhcIiB8fFxuXHRcdHZhbHVlID09PSBcImhlaWdodFwiIHx8XG5cdFx0dmFsdWUgPT09IFwiY29udGFpblwiIHx8XG5cdFx0dmFsdWUgPT09IFwiY292ZXJcIiB8fFxuXHRcdHZhbHVlID09PSBcIm5vbmVcIiB8fFxuXHRcdHZhbHVlID09PSBcInNjYWxlRG93blwiIHx8XG5cdFx0dmFsdWUgPT09IFwib3JpZ2luXCJcblx0KTtcbn1cblxuZnVuY3Rpb24gaXNPZmZTY3JlZW5VcGRhdGVCZWhhdmlvdXJUeXBlICh2YWx1ZTogc3RyaW5nIHwgbnVsbCk6IHZhbHVlIGlzIE9mZlNjcmVlblVwZGF0ZUJlaGF2aW91clR5cGUge1xuXHRyZXR1cm4gKFxuXHRcdHZhbHVlID09PSBcInBhdXNlXCIgfHxcblx0XHR2YWx1ZSA9PT0gXCJ1cGRhdGVcIiB8fFxuXHRcdHZhbHVlID09PSBcInBvc2VcIlxuXHQpO1xufVxuXG5jb25zdCBiYXNlNjRSZWdFeHAgPSAvXigoW0EtWmEtejAtOSsvXXs0fSkqKFtBLVphLXowLTkrL117NH18W0EtWmEtejAtOSsvXXszfT18W0EtWmEtejAtOSsvXXsyfT09KSkkLztcbmV4cG9ydCBmdW5jdGlvbiBpc0Jhc2U2NCAoc3RyOiBzdHJpbmcpIHtcblx0cmV0dXJuIGJhc2U2NFJlZ0V4cC50ZXN0KHN0cik7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUG9pbnQge1xuXHR4OiBudW1iZXIsXG5cdHk6IG51bWJlcixcbn1cblxuZXhwb3J0IGludGVyZmFjZSBSZWN0YW5nbGUgZXh0ZW5kcyBQb2ludCB7XG5cdHdpZHRoOiBudW1iZXIsXG5cdGhlaWdodDogbnVtYmVyLFxufSJdfQ==