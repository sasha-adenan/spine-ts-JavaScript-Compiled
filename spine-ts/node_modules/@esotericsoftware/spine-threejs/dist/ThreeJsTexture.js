/******************************************************************************
 * Spine Runtimes License Agreement
 * Last updated April 5, 2025. Replaces all prior versions.
 *
 * Copyright (c) 2013-2025, Esoteric Software LLC
 *
 * Integration of the Spine Runtimes into software or otherwise creating
 * derivative works of the Spine Runtimes is permitted under the terms and
 * conditions of Section 2 of the Spine Editor License Agreement:
 * http://esotericsoftware.com/spine-editor-license
 *
 * Otherwise, it is permitted to integrate the Spine Runtimes into software
 * or otherwise create derivative works of the Spine Runtimes (collectively,
 * "Products"), provided that each user of the Products must obtain their own
 * Spine Editor license and redistribution of the Products in any form must
 * include this license and copyright notice.
 *
 * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,
 * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************/
import { BlendMode, Texture, TextureFilter, TextureWrap } from "@esotericsoftware/spine-core";
import * as THREE from "three";
export class ThreeJsTexture extends Texture {
    texture;
    constructor(image, pma = false) {
        super(image);
        if (image instanceof ImageBitmap)
            this.texture = new THREE.CanvasTexture(image);
        else
            this.texture = new THREE.Texture(image);
        // if the texture is not pma, we ask to threejs to premultiply on upload
        this.texture.premultiplyAlpha = !pma;
        this.texture.flipY = false;
        // Keep this as a reference - this is necessary in future versions of ThreeJS
        // this.texture.colorSpace = THREE.SRGBColorSpace;
        this.texture.needsUpdate = true;
    }
    setFilters(minFilter, magFilter) {
        this.texture.minFilter = ThreeJsTexture.toThreeJsMinificationTextureFilter(minFilter);
        this.texture.magFilter = ThreeJsTexture.toThreeJsMagnificationTextureFilter(magFilter);
    }
    setWraps(uWrap, vWrap) {
        this.texture.wrapS = ThreeJsTexture.toThreeJsTextureWrap(uWrap);
        this.texture.wrapT = ThreeJsTexture.toThreeJsTextureWrap(vWrap);
    }
    dispose() {
        this.texture.dispose();
    }
    static toThreeJsMinificationTextureFilter(filter) {
        if (filter === TextureFilter.Linear)
            return THREE.LinearFilter;
        else if (filter === TextureFilter.MipMap)
            return THREE.LinearMipMapLinearFilter; // also includes TextureFilter.MipMapLinearLinear
        else if (filter === TextureFilter.MipMapLinearNearest)
            return THREE.LinearMipMapNearestFilter;
        else if (filter === TextureFilter.MipMapNearestLinear)
            return THREE.NearestMipMapLinearFilter;
        else if (filter === TextureFilter.MipMapNearestNearest)
            return THREE.NearestMipMapNearestFilter;
        else if (filter === TextureFilter.Nearest)
            return THREE.NearestFilter;
        else
            throw new Error("Unknown texture filter: " + filter);
    }
    static toThreeJsMagnificationTextureFilter(filter) {
        if (filter === TextureFilter.Linear)
            return THREE.LinearFilter;
        else if (filter === TextureFilter.MipMap)
            return THREE.LinearFilter;
        else if (filter === TextureFilter.MipMapLinearNearest)
            return THREE.NearestFilter;
        else if (filter === TextureFilter.MipMapNearestLinear)
            return THREE.LinearFilter;
        else if (filter === TextureFilter.MipMapNearestNearest)
            return THREE.NearestFilter;
        else if (filter === TextureFilter.Nearest)
            return THREE.NearestFilter;
        else
            throw new Error("Unknown texture filter: " + filter);
    }
    static toThreeJsTextureWrap(wrap) {
        if (wrap === TextureWrap.ClampToEdge)
            return THREE.ClampToEdgeWrapping;
        else if (wrap === TextureWrap.MirroredRepeat)
            return THREE.MirroredRepeatWrapping;
        else if (wrap === TextureWrap.Repeat)
            return THREE.RepeatWrapping;
        else
            throw new Error("Unknown texture wrap: " + wrap);
    }
    static fist = true;
    static toThreeJsBlending(blend) {
        if (blend === BlendMode.Normal)
            return { blending: THREE.NormalBlending };
        else if (blend === BlendMode.Additive)
            return { blending: THREE.AdditiveBlending };
        // else if (blend === BlendMode.Multiply) return { blending: THREE.NormalBlending };
        else if (blend === BlendMode.Multiply)
            return {
                blending: THREE.CustomBlending,
                blendSrc: THREE.DstColorFactor,
                blendDst: THREE.OneMinusSrcAlphaFactor,
                blendSrcAlpha: THREE.OneFactor,
                blendDstAlpha: THREE.OneMinusSrcAlphaFactor,
            };
        else if (blend === BlendMode.Screen)
            return {
                blending: THREE.CustomBlending,
                blendSrc: THREE.OneFactor,
                blendDst: THREE.OneMinusSrcColorFactor,
                blendSrcAlpha: THREE.OneFactor,
                blendDstAlpha: THREE.OneMinusSrcColorFactor,
            };
        else
            throw new Error("Unknown blendMode: " + blend);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGhyZWVKc1RleHR1cmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvVGhyZWVKc1RleHR1cmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OzsrRUEyQitFO0FBRS9FLE9BQU8sRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFFLGFBQWEsRUFBRSxXQUFXLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUM5RixPQUFPLEtBQUssS0FBSyxNQUFNLE9BQU8sQ0FBQztBQUUvQixNQUFNLE9BQU8sY0FBZSxTQUFRLE9BQU87SUFDMUMsT0FBTyxDQUFnQjtJQUV2QixZQUFhLEtBQXFDLEVBQUUsR0FBRyxHQUFHLEtBQUs7UUFDOUQsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2IsSUFBSSxLQUFLLFlBQVksV0FBVztZQUMvQixJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksS0FBSyxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQzs7WUFFOUMsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDekMsd0VBQXdFO1FBQ3hFLElBQUksQ0FBQyxPQUFPLENBQUMsZ0JBQWdCLEdBQUcsQ0FBQyxHQUFHLENBQUM7UUFDckMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO1FBRTNCLDZFQUE2RTtRQUM3RSxrREFBa0Q7UUFFbEQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDO0lBQ2pDLENBQUM7SUFFRCxVQUFVLENBQUUsU0FBd0IsRUFBRSxTQUF3QjtRQUM3RCxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsR0FBRyxjQUFjLENBQUMsa0NBQWtDLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDdEYsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEdBQUcsY0FBYyxDQUFDLG1DQUFtQyxDQUFDLFNB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UUFBUSxFQUFFLEtBQUssQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1FBQ25GLG9GQUFvRjthQUMvRSxJQUFJLEtBQUssS0FBSyxTQUFTLENBQUMsUUFBUTtZQUFFLE9BQU87Z0JBQzdDLFFBQVEsRUFBRSxLQUFLLENBQUMsY0FBYztnQkFDOUIsUUFBUSxFQUFFLEtBQUssQ0FBQyxjQUFjO2dCQUM5QixRQUFRLEVBQUUsS0FBSyxDQUFDLHNCQUFzQjtnQkFDdEMsYUFBYSxFQUFFLEtBQUssQ0FBQyxTQUFTO2dCQUM5QixhQUFhLEVBQUUsS0FBSyxDQUFDLHNCQUFzQjthQUMzQyxDQUFBO2FBQ0ksSUFBSSxLQUFLLEtBQUssU0FBUyxDQUFDLE1BQU07WUFBRSxPQUFPO2dCQUMzQyxRQUFRLEVBQUUsS0FBSyxDQUFDLGNBQWM7Z0JBQzlCLFFBQVEsRUFBRSxLQUFLLENBQUMsU0FBUztnQkFDekIsUUFBUSxFQUFFLEtBQUssQ0FBQyxzQkFBc0I7Z0JBQ3RDLGFBQWEsRUFBRSxLQUFLLENBQUMsU0FBUztnQkFDOUIsYUFBYSxFQUFFLEtBQUssQ0FBQyxzQkFBc0I7YUFDM0MsQ0FBQTs7WUFDSSxNQUFNLElBQUksS0FBSyxDQUFDLHFCQUFxQixHQUFHLEtBQUssQ0FBQyxDQUFDO0lBQ3JELENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gKiBTcGluZSBSdW50aW1lcyBMaWNlbnNlIEFncmVlbWVudFxuICogTGFzdCB1cGRhdGVkIEFwcmlsIDUsIDIwMjUuIFJlcGxhY2VzIGFsbCBwcmlvciB2ZXJzaW9ucy5cbiAqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAyNSwgRXNvdGVyaWMgU29mdHdhcmUgTExDXG4gKlxuICogSW50ZWdyYXRpb24gb2YgdGhlIFNwaW5lIFJ1bnRpbWVzIGludG8gc29mdHdhcmUgb3Igb3RoZXJ3aXNlIGNyZWF0aW5nXG4gKiBkZXJpdmF0aXZlIHdvcmtzIG9mIHRoZSBTcGluZSBSdW50aW1lcyBpcyBwZXJtaXR0ZWQgdW5kZXIgdGhlIHRlcm1zIGFuZFxuICogY29uZGl0aW9ucyBvZiBTZWN0aW9uIDIgb2YgdGhlIFNwaW5lIEVkaXRvciBMaWNlbnNlIEFncmVlbWVudDpcbiAqIGh0dHA6Ly9lc290ZXJpY3NvZnR3YXJlLmNvbS9zcGluZS1lZGl0b3ItbGljZW5zZVxuICpcbiAqIE90aGVyd2lzZSwgaXQgaXMgcGVybWl0dGVkIHRvIGludGVncmF0ZSB0aGUgU3BpbmUgUnVudGltZXMgaW50byBzb2Z0d2FyZVxuICogb3Igb3RoZXJ3aXNlIGNyZWF0ZSBkZXJpdmF0aXZlIHdvcmtzIG9mIHRoZSBTcGluZSBSdW50aW1lcyAoY29sbGVjdGl2ZWx5LFxuICogXCJQcm9kdWN0c1wiKSwgcHJvdmlkZWQgdGhhdCBlYWNoIHVzZXIgb2YgdGhlIFByb2R1Y3RzIG11c3Qgb2J0YWluIHRoZWlyIG93blxuICogU3BpbmUgRWRpdG9yIGxpY2Vuc2UgYW5kIHJlZGlzdHJpYnV0aW9uIG9mIHRoZSBQcm9kdWN0cyBpbiBhbnkgZm9ybSBtdXN0XG4gKiBpbmNsdWRlIHRoaXMgbGljZW5zZSBhbmQgY29weXJpZ2h0IG5vdGljZS5cbiAqXG4gKiBUSEUgU1BJTkUgUlVOVElNRVMgQVJFIFBST1ZJREVEIEJZIEVTT1RFUklDIFNPRlRXQVJFIExMQyBcIkFTIElTXCIgQU5EIEFOWVxuICogRVhQUkVTUyBPUiBJTVBMSUVEIFdBUlJBTlRJRVMsIElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBUSEUgSU1QTElFRFxuICogV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFSRVxuICogRElTQ0xBSU1FRC4gSU4gTk8gRVZFTlQgU0hBTEwgRVNPVEVSSUMgU09GVFdBUkUgTExDIEJFIExJQUJMRSBGT1IgQU5ZXG4gKiBESVJFQ1QsIElORElSRUNULCBJTkNJREVOVEFMLCBTUEVDSUFMLCBFWEVNUExBUlksIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFU1xuICogKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTLFxuICogQlVTSU5FU1MgSU5URVJSVVBUSU9OLCBPUiBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUykgSE9XRVZFUiBDQVVTRUQgQU5EXG4gKiBPTiBBTlkgVEhFT1JZIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUIExJQUJJTElUWSwgT1IgVE9SVFxuICogKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkgQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFIE9GXG4gKiBUSEUgU1BJTkUgUlVOVElNRVMsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUgUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5cbmltcG9ydCB7IEJsZW5kTW9kZSwgVGV4dHVyZSwgVGV4dHVyZUZpbHRlciwgVGV4dHVyZVdyYXAgfSBmcm9tIFwiQGVzb3Rlcmljc29mdHdhcmUvc3BpbmUtY29yZVwiO1xuaW1wb3J0ICogYXMgVEhSRUUgZnJvbSBcInRocmVlXCI7XG5cbmV4cG9ydCBjbGFzcyBUaHJlZUpzVGV4dHVyZSBleHRlbmRzIFRleHR1cmUge1xuXHR0ZXh0dXJlOiBUSFJFRS5UZXh0dXJlO1xuXG5cdGNvbnN0cnVjdG9yIChpbWFnZTogSFRNTEltYWdlRWxlbWVudCB8IEltYWdlQml0bWFwLCBwbWEgPSBmYWxzZSkge1xuXHRcdHN1cGVyKGltYWdlKTtcblx0XHRpZiAoaW1hZ2UgaW5zdGFuY2VvZiBJbWFnZUJpdG1hcClcblx0XHRcdHRoaXMudGV4dHVyZSA9IG5ldyBUSFJFRS5DYW52YXNUZXh0dXJlKGltYWdlKTtcblx0XHRlbHNlXG5cdFx0XHR0aGlzLnRleHR1cmUgPSBuZXcgVEhSRUUuVGV4dHVyZShpbWFnZSk7XG5cdFx0Ly8gaWYgdGhlIHRleHR1cmUgaXMgbm90IHBtYSwgd2UgYXNrIHRvIHRocmVlanMgdG8gcHJlbXVsdGlwbHkgb24gdXBsb2FkXG5cdFx0dGhpcy50ZXh0dXJlLnByZW11bHRpcGx5QWxwaGEgPSAhcG1hO1xuXHRcdHRoaXMudGV4dHVyZS5mbGlwWSA9IGZhbHNlO1xuXG5cdFx0Ly8gS2VlcCB0aGlzIGFzIGEgcmVmZXJlbmNlIC0gdGhpcyBpcyBuZWNlc3NhcnkgaW4gZnV0dXJlIHZlcnNpb25zIG9mIFRocmVlSlNcblx0XHQvLyB0aGlzLnRleHR1cmUuY29sb3JTcGFjZSA9IFRIUkVFLlNSR0JDb2xvclNwYWNlO1xuXG5cdFx0dGhpcy50ZXh0dXJlLm5lZWRzVXBkYXRlID0gdHJ1ZTtcblx0fVxuXG5cdHNldEZpbHRlcnMgKG1pbkZpbHRlcjogVGV4dHVyZUZpbHRlciwgbWFnRmlsdGVyOiBUZXh0dXJlRmlsdGVyKSB7XG5cdFx0dGhpcy50ZXh0dXJlLm1pbkZpbHRlciA9IFRocmVlSnNUZXh0dXJlLnRvVGhyZWVKc01pbmlmaWNhdGlvblRleHR1cmVGaWx0ZXIobWluRmlsdGVyKTtcblx0XHR0aGlzLnRleHR1cmUubWFnRmlsdGVyID0gVGhyZWVKc1RleHR1cmUudG9UaHJlZUpzTWFnbmlmaWNhdGlvblRleHR1cmVGaWx0ZXIobWFnRmlsdGVyKTtcblx0fVxuXG5cdHNldFdyYXBzICh1V3JhcDogVGV4dHVyZVdyYXAsIHZXcmFwOiBUZXh0dXJlV3JhcCkge1xuXHRcdHRoaXMudGV4dHVyZS53cmFwUyA9IFRocmVlSnNUZXh0dXJlLnRvVGhyZWVKc1RleHR1cmVXcmFwKHVXcmFwKTtcblx0XHR0aGlzLnRleHR1cmUud3JhcFQgPSBUaHJlZUpzVGV4dHVyZS50b1RocmVlSnNUZXh0dXJlV3JhcCh2V3JhcCk7XG5cdH1cblxuXHRkaXNwb3NlICgpIHtcblx0XHR0aGlzLnRleHR1cmUuZGlzcG9zZSgpO1xuXHR9XG5cblx0c3RhdGljIHRvVGhyZWVKc01pbmlmaWNhdGlvblRleHR1cmVGaWx0ZXIgKGZpbHRlcjogVGV4dHVyZUZpbHRlcik6IFRIUkVFLk1pbmlmaWNhdGlvblRleHR1cmVGaWx0ZXIge1xuXHRcdGlmIChmaWx0ZXIgPT09IFRleHR1cmVGaWx0ZXIuTGluZWFyKSByZXR1cm4gVEhSRUUuTGluZWFyRmlsdGVyO1xuXHRcdGVsc2UgaWYgKGZpbHRlciA9PT0gVGV4dHVyZUZpbHRlci5NaXBNYXApIHJldHVybiBUSFJFRS5MaW5lYXJNaXBNYXBMaW5lYXJGaWx0ZXI7IC8vIGFsc28gaW5jbHVkZXMgVGV4dHVyZUZpbHRlci5NaXBNYXBMaW5lYXJMaW5lYXJcblx0XHRlbHNlIGlmIChmaWx0ZXIgPT09IFRleHR1cmVGaWx0ZXIuTWlwTWFwTGluZWFyTmVhcmVzdCkgcmV0dXJuIFRIUkVFLkxpbmVhck1pcE1hcE5lYXJlc3RGaWx0ZXI7XG5cdFx0ZWxzZSBpZiAoZmlsdGVyID09PSBUZXh0dXJlRmlsdGVyLk1pcE1hcE5lYXJlc3RMaW5lYXIpIHJldHVybiBUSFJFRS5OZWFyZXN0TWlwTWFwTGluZWFyRmlsdGVyO1xuXHRcdGVsc2UgaWYgKGZpbHRlciA9PT0gVGV4dHVyZUZpbHRlci5NaXBNYXBOZWFyZXN0TmVhcmVzdCkgcmV0dXJuIFRIUkVFLk5lYXJlc3RNaXBNYXBOZWFyZXN0RmlsdGVyO1xuXHRcdGVsc2UgaWYgKGZpbHRlciA9PT0gVGV4dHVyZUZpbHRlci5OZWFyZXN0KSByZXR1cm4gVEhSRUUuTmVhcmVzdEZpbHRlcjtcblx0XHRlbHNlIHRocm93IG5ldyBFcnJvcihcIlVua25vd24gdGV4dHVyZSBmaWx0ZXI6IFwiICsgZmlsdGVyKTtcblx0fVxuXG5cdHN0YXRpYyB0b1RocmVlSnNNYWduaWZpY2F0aW9uVGV4dHVyZUZpbHRlciAoZmlsdGVyOiBUZXh0dXJlRmlsdGVyKTogVEhSRUUuTWFnbmlmaWNhdGlvblRleHR1cmVGaWx0ZXIge1xuXHRcdGlmIChmaWx0ZXIgPT09IFRleHR1cmVGaWx0ZXIuTGluZWFyKSByZXR1cm4gVEhSRUUuTGluZWFyRmlsdGVyO1xuXHRcdGVsc2UgaWYgKGZpbHRlciA9PT0gVGV4dHVyZUZpbHRlci5NaXBNYXApIHJldHVybiBUSFJFRS5MaW5lYXJGaWx0ZXI7XG5cdFx0ZWxzZSBpZiAoZmlsdGVyID09PSBUZXh0dXJlRmlsdGVyLk1pcE1hcExpbmVhck5lYXJlc3QpIHJldHVybiBUSFJFRS5OZWFyZXN0RmlsdGVyO1xuXHRcdGVsc2UgaWYgKGZpbHRlciA9PT0gVGV4dHVyZUZpbHRlci5NaXBNYXBOZWFyZXN0TGluZWFyKSByZXR1cm4gVEhSRUUuTGluZWFyRmlsdGVyO1xuXHRcdGVsc2UgaWYgKGZpbHRlciA9PT0gVGV4dHVyZUZpbHRlci5NaXBNYXBOZWFyZXN0TmVhcmVzdCkgcmV0dXJuIFRIUkVFLk5lYXJlc3RGaWx0ZXI7XG5cdFx0ZWxzZSBpZiAoZmlsdGVyID09PSBUZXh0dXJlRmlsdGVyLk5lYXJlc3QpIHJldHVybiBUSFJFRS5OZWFyZXN0RmlsdGVyO1xuXHRcdGVsc2UgdGhyb3cgbmV3IEVycm9yKFwiVW5rbm93biB0ZXh0dXJlIGZpbHRlcjogXCIgKyBmaWx0ZXIpO1xuXHR9XG5cblx0c3RhdGljIHRvVGhyZWVKc1RleHR1cmVXcmFwICh3cmFwOiBUZXh0dXJlV3JhcCkge1xuXHRcdGlmICh3cmFwID09PSBUZXh0dXJlV3JhcC5DbGFtcFRvRWRnZSkgcmV0dXJuIFRIUkVFLkNsYW1wVG9FZGdlV3JhcHBpbmc7XG5cdFx0ZWxzZSBpZiAod3JhcCA9PT0gVGV4dHVyZVdyYXAuTWlycm9yZWRSZXBlYXQpIHJldHVybiBUSFJFRS5NaXJyb3JlZFJlcGVhdFdyYXBwaW5nO1xuXHRcdGVsc2UgaWYgKHdyYXAgPT09IFRleHR1cmVXcmFwLlJlcGVhdCkgcmV0dXJuIFRIUkVFLlJlcGVhdFdyYXBwaW5nO1xuXHRcdGVsc2UgdGhyb3cgbmV3IEVycm9yKFwiVW5rbm93biB0ZXh0dXJlIHdyYXA6IFwiICsgd3JhcCk7XG5cdH1cblxuXHRzdGF0aWMgZmlzdCA9IHRydWU7XG5cdHN0YXRpYyB0b1RocmVlSnNCbGVuZGluZyAoYmxlbmQ6IEJsZW5kTW9kZSk6IFRocmVlQmxlbmRPcHRpb25zIHtcblx0XHRpZiAoYmxlbmQgPT09IEJsZW5kTW9kZS5Ob3JtYWwpIHJldHVybiB7IGJsZW5kaW5nOiBUSFJFRS5Ob3JtYWxCbGVuZGluZyB9O1xuXHRcdGVsc2UgaWYgKGJsZW5kID09PSBCbGVuZE1vZGUuQWRkaXRpdmUpIHJldHVybiB7IGJsZW5kaW5nOiBUSFJFRS5BZGRpdGl2ZUJsZW5kaW5nIH07XG5cdFx0Ly8gZWxzZSBpZiAoYmxlbmQgPT09IEJsZW5kTW9kZS5NdWx0aXBseSkgcmV0dXJuIHsgYmxlbmRpbmc6IFRIUkVFLk5vcm1hbEJsZW5kaW5nIH07XG5cdFx0ZWxzZSBpZiAoYmxlbmQgPT09IEJsZW5kTW9kZS5NdWx0aXBseSkgcmV0dXJuIHtcblx0XHRcdGJsZW5kaW5nOiBUSFJFRS5DdXN0b21CbGVuZGluZyxcblx0XHRcdGJsZW5kU3JjOiBUSFJFRS5Ec3RDb2xvckZhY3Rvcixcblx0XHRcdGJsZW5kRHN0OiBUSFJFRS5PbmVNaW51c1NyY0FscGhhRmFjdG9yLFxuXHRcdFx0YmxlbmRTcmNBbHBoYTogVEhSRUUuT25lRmFjdG9yLFxuXHRcdFx0YmxlbmREc3RBbHBoYTogVEhSRUUuT25lTWludXNTcmNBbHBoYUZhY3Rvcixcblx0XHR9XG5cdFx0ZWxzZSBpZiAoYmxlbmQgPT09IEJsZW5kTW9kZS5TY3JlZW4pIHJldHVybiB7XG5cdFx0XHRibGVuZGluZzogVEhSRUUuQ3VzdG9tQmxlbmRpbmcsXG5cdFx0XHRibGVuZFNyYzogVEhSRUUuT25lRmFjdG9yLFxuXHRcdFx0YmxlbmREc3Q6IFRIUkVFLk9uZU1pbnVzU3JjQ29sb3JGYWN0b3IsXG5cdFx0XHRibGVuZFNyY0FscGhhOiBUSFJFRS5PbmVGYWN0b3IsXG5cdFx0XHRibGVuZERzdEFscGhhOiBUSFJFRS5PbmVNaW51c1NyY0NvbG9yRmFjdG9yLFxuXHRcdH1cblx0XHRlbHNlIHRocm93IG5ldyBFcnJvcihcIlVua25vd24gYmxlbmRNb2RlOiBcIiArIGJsZW5kKTtcblx0fVxufVxuXG5leHBvcnQgdHlwZSBUaHJlZUJsZW5kT3B0aW9ucyA9IHtcblx0YmxlbmRpbmc6IFRIUkVFLkJsZW5kaW5nLFxuXHRibGVuZFNyYz86IFRIUkVFLkJsZW5kaW5nRHN0RmFjdG9yLFxuXHRibGVuZERzdD86IFRIUkVFLkJsZW5kaW5nRHN0RmFjdG9yLFxuXHRibGVuZFNyY0FscGhhPzogVEhSRUUuQmxlbmRpbmdEc3RGYWN0b3IsXG5cdGJsZW5kRHN0QWxwaGE/OiBUSFJFRS5CbGVuZGluZ0RzdEZhY3Rvcixcbn1cbiJdfQ==