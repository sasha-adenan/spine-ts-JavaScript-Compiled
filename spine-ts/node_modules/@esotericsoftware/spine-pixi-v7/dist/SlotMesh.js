/******************************************************************************
 * Spine Runtimes License Agreement
 * Last updated April 5, 2025. Replaces all prior versions.
 *
 * Copyright (c) 2013-2025, Esoteric Software LLC
 *
 * Integration of the Spine Runtimes into software or otherwise creating
 * derivative works of the Spine Runtimes is permitted under the terms and
 * conditions of Section 2 of the Spine Editor License Agreement:
 * http://esotericsoftware.com/spine-editor-license
 *
 * Otherwise, it is permitted to integrate the Spine Runtimes into software
 * or otherwise create derivative works of the Spine Runtimes (collectively,
 * "Products"), provided that each user of the Products must obtain their own
 * Spine Editor license and redistribution of the Products in any form must
 * include this license and copyright notice.
 *
 * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,
 * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************/
import { SpineTexture } from "./SpineTexture.js";
import { Mesh, MeshGeometry, MeshMaterial } from "@pixi/mesh";
import { Texture } from "@pixi/core";
export class SlotMesh extends Mesh {
    name = "";
    static auxColor = [0, 0, 0, 0];
    warnedTwoTint = false;
    constructor() {
        const geometry = new MeshGeometry();
        geometry.getBuffer("aVertexPosition").static = false;
        geometry.getBuffer("aTextureCoord").static = false;
        const meshMaterial = new MeshMaterial(Texture.EMPTY);
        super(geometry, meshMaterial);
    }
    updateFromSpineData(slotTexture, slotBlendMode, slotName, finalVertices, finalVerticesLength, finalIndices, finalIndicesLength, darkTint) {
        this.texture = slotTexture.texture;
        const vertLenght = (finalVerticesLength / (darkTint ? 12 : 8)) * 2;
        const textureCoord = this.geometry.getBuffer("aTextureCoord");
        if (textureCoord.data?.length !== vertLenght) {
            textureCoord.data = new Float32Array(vertLenght);
        }
        const vertexCoord = this.geometry.getBuffer("aVertexPosition");
        if (vertexCoord.data?.length !== vertLenght) {
            vertexCoord.data = new Float32Array(vertLenght);
        }
        let vertIndex = 0;
        let textureCoordData = textureCoord.data;
        let vertexCoordData = vertexCoord.data;
        for (let i = 0; i < finalVerticesLength; i += darkTint ? 12 : 8) {
            let auxi = i;
            vertexCoordData[vertIndex] = finalVertices[auxi++];
            vertexCoordData[vertIndex + 1] = finalVertices[auxi++];
            auxi += 4; // color
            textureCoordData[vertIndex] = finalVertices[auxi++];
            textureCoordData[vertIndex + 1] = finalVertices[auxi++];
            vertIndex += 2;
        }
        if (darkTint && !this.warnedTwoTint) {
            console.warn("DarkTint is not enabled by default. To enable use a DarkSlotMesh factory while creating the Spine object.");
            this.warnedTwoTint = true;
        }
        SlotMesh.auxColor[0] = finalVertices[2];
        SlotMesh.auxColor[1] = finalVertices[3];
        SlotMesh.auxColor[2] = finalVertices[4];
        SlotMesh.auxColor[3] = finalVertices[5];
        this.tint = SlotMesh.auxColor;
        this.alpha = SlotMesh.auxColor[3];
        this.blendMode = SpineTexture.toPixiBlending(slotBlendMode);
        const indexBuffer = this.geometry.indexBuffer;
        if (indexBuffer.data.length !== finalIndices.length) {
            indexBuffer.data = new Uint32Array(finalIndices);
        }
        else {
            const indexBufferData = indexBuffer.data;
            for (let i = 0; i < finalIndicesLength; i++) {
                indexBufferData[i] = finalIndices[i];
            }
        }
        this.name = slotName;
        textureCoord.update();
        vertexCoord.update();
        indexBuffer.update();
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2xvdE1lc2guanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvU2xvdE1lc2gudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OzsrRUEyQitFO0FBRS9FLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUdqRCxPQUFPLEVBQUUsSUFBSSxFQUFFLFlBQVksRUFBRSxZQUFZLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFDOUQsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLFlBQVksQ0FBQztBQUVyQyxNQUFNLE9BQU8sUUFBUyxTQUFRLElBQUk7SUFDMUIsSUFBSSxHQUFXLEVBQUUsQ0FBQztJQUVqQixNQUFNLENBQVUsUUFBUSxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDeEMsYUFBYSxHQUFZLEtBQUssQ0FBQztJQUV2QztRQUNDLE1BQU0sUUFBUSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFFcEMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLE1BQU0sR0FBRyxLQUFLLENBQUM7UUFDckQsUUFBUSxDQUFDLFNBQVMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDO1FBRW5ELE1BQU0sWUFBWSxHQUFHLElBQUksWUFBWSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNyRCxLQUFLLENBQUMsUUFBUSxFQUFFLFlBQVksQ0FBQyxDQUFDO0lBQy9CLENBQUM7SUFDTSxtQkFBbUIsQ0FDekIsV0FBeUIsRUFDekIsYUFBd0IsRUFDeEIsUUFBZ0IsRUFDaEIsYUFBOEIsRUFDOUIsbUJBQTJCLEVBQzNCLFlBQTZCLEVBQzdCLGtCQUEwQixFQUMxQixRQUFpQjtRQUVqQixJQUFJLENBQUMsT0FBTyxHQUFHLFdBQVcsQ0FBQyxPQUFPLENBQUM7UUFFbkMsTUFBTSxV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RyxJQUFJLFdBQVcsQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUNsRCxDQUFDO2FBQU0sQ0FBQztZQUNQLE1BQU0sZUFBZSxHQUFHLFdBQVcsQ0FBQyxJQUFJLENBQUM7WUFDekMsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLGtCQUFrQixFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7Z0JBQzdDLGVBQWUsQ0FBQyxDQUFDLENBQUMsR0FBRyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDdEMsQ0FBQztRQUNGLENBQUM7UUFFRCxJQUFJLENBQUMsSUFBSSxHQUFHLFFBQVEsQ0FBQztRQUVyQixZQUFZLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDdEIsV0FBVyxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQ3JCLFdBQVcsQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUN0QixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICogU3BpbmUgUnVudGltZXMgTGljZW5zZSBBZ3JlZW1lbnRcbiAqIExhc3QgdXBkYXRlZCBBcHJpbCA1LCAyMDI1LiBSZXBsYWNlcyBhbGwgcHJpb3IgdmVyc2lvbnMuXG4gKlxuICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMjUsIEVzb3RlcmljIFNvZnR3YXJlIExMQ1xuICpcbiAqIEludGVncmF0aW9uIG9mIHRoZSBTcGluZSBSdW50aW1lcyBpbnRvIHNvZnR3YXJlIG9yIG90aGVyd2lzZSBjcmVhdGluZ1xuICogZGVyaXZhdGl2ZSB3b3JrcyBvZiB0aGUgU3BpbmUgUnVudGltZXMgaXMgcGVybWl0dGVkIHVuZGVyIHRoZSB0ZXJtcyBhbmRcbiAqIGNvbmRpdGlvbnMgb2YgU2VjdGlvbiAyIG9mIHRoZSBTcGluZSBFZGl0b3IgTGljZW5zZSBBZ3JlZW1lbnQ6XG4gKiBodHRwOi8vZXNvdGVyaWNzb2Z0d2FyZS5jb20vc3BpbmUtZWRpdG9yLWxpY2Vuc2VcbiAqXG4gKiBPdGhlcndpc2UsIGl0IGlzIHBlcm1pdHRlZCB0byBpbnRlZ3JhdGUgdGhlIFNwaW5lIFJ1bnRpbWVzIGludG8gc29mdHdhcmVcbiAqIG9yIG90aGVyd2lzZSBjcmVhdGUgZGVyaXZhdGl2ZSB3b3JrcyBvZiB0aGUgU3BpbmUgUnVudGltZXMgKGNvbGxlY3RpdmVseSxcbiAqIFwiUHJvZHVjdHNcIiksIHByb3ZpZGVkIHRoYXQgZWFjaCB1c2VyIG9mIHRoZSBQcm9kdWN0cyBtdXN0IG9idGFpbiB0aGVpciBvd25cbiAqIFNwaW5lIEVkaXRvciBsaWNlbnNlIGFuZCByZWRpc3RyaWJ1dGlvbiBvZiB0aGUgUHJvZHVjdHMgaW4gYW55IGZvcm0gbXVzdFxuICogaW5jbHVkZSB0aGlzIGxpY2Vuc2UgYW5kIGNvcHlyaWdodCBub3RpY2UuXG4gKlxuICogVEhFIFNQSU5FIFJVTlRJTUVTIEFSRSBQUk9WSURFRCBCWSBFU09URVJJQyBTT0ZUV0FSRSBMTEMgXCJBUyBJU1wiIEFORCBBTllcbiAqIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFIElNUExJRURcbiAqIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBUkVcbiAqIERJU0NMQUlNRUQuIElOIE5PIEVWRU5UIFNIQUxMIEVTT1RFUklDIFNPRlRXQVJFIExMQyBCRSBMSUFCTEUgRk9SIEFOWVxuICogRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVNcbiAqIChJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgUFJPQ1VSRU1FTlQgT0YgU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUyxcbiAqIEJVU0lORVNTIElOVEVSUlVQVElPTiwgT1IgTE9TUyBPRiBVU0UsIERBVEEsIE9SIFBST0ZJVFMpIEhPV0VWRVIgQ0FVU0VEIEFORFxuICogT04gQU5ZIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlRcbiAqIChJTkNMVURJTkcgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRlxuICogVEhFIFNQSU5FIFJVTlRJTUVTLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLlxuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuXG5pbXBvcnQgeyBTcGluZVRleHR1cmUgfSBmcm9tIFwiLi9TcGluZVRleHR1cmUuanNcIjtcbmltcG9ydCB0eXBlIHsgQmxlbmRNb2RlLCBOdW1iZXJBcnJheUxpa2UgfSBmcm9tIFwiQGVzb3Rlcmljc29mdHdhcmUvc3BpbmUtY29yZVwiO1xuaW1wb3J0IHR5cGUgeyBJU2xvdE1lc2ggfSBmcm9tIFwiLi9TcGluZS5qc1wiO1xuaW1wb3J0IHsgTWVzaCwgTWVzaEdlb21ldHJ5LCBNZXNoTWF0ZXJpYWwgfSBmcm9tIFwiQHBpeGkvbWVzaFwiO1xuaW1wb3J0IHsgVGV4dHVyZSB9IGZyb20gXCJAcGl4aS9jb3JlXCI7XG5cbmV4cG9ydCBjbGFzcyBTbG90TWVzaCBleHRlbmRzIE1lc2ggaW1wbGVtZW50cyBJU2xvdE1lc2gge1xuXHRwdWJsaWMgbmFtZTogc3RyaW5nID0gXCJcIjtcblxuXHRwcml2YXRlIHN0YXRpYyByZWFkb25seSBhdXhDb2xvciA9IFswLCAwLCAwLCAwXTtcblx0cHJpdmF0ZSB3YXJuZWRUd29UaW50OiBib29sZWFuID0gZmFsc2U7XG5cblx0Y29uc3RydWN0b3IgKCkge1xuXHRcdGNvbnN0IGdlb21ldHJ5ID0gbmV3IE1lc2hHZW9tZXRyeSgpO1xuXG5cdFx0Z2VvbWV0cnkuZ2V0QnVmZmVyKFwiYVZlcnRleFBvc2l0aW9uXCIpLnN0YXRpYyA9IGZhbHNlO1xuXHRcdGdlb21ldHJ5LmdldEJ1ZmZlcihcImFUZXh0dXJlQ29vcmRcIikuc3RhdGljID0gZmFsc2U7XG5cblx0XHRjb25zdCBtZXNoTWF0ZXJpYWwgPSBuZXcgTWVzaE1hdGVyaWFsKFRleHR1cmUuRU1QVFkpO1xuXHRcdHN1cGVyKGdlb21ldHJ5LCBtZXNoTWF0ZXJpYWwpO1xuXHR9XG5cdHB1YmxpYyB1cGRhdGVGcm9tU3BpbmVEYXRhIChcblx0XHRzbG90VGV4dHVyZTogU3BpbmVUZXh0dXJlLFxuXHRcdHNsb3RCbGVuZE1vZGU6IEJsZW5kTW9kZSxcblx0XHRzbG90TmFtZTogc3RyaW5nLFxuXHRcdGZpbmFsVmVydGljZXM6IE51bWJlckFycmF5TGlrZSxcblx0XHRmaW5hbFZlcnRpY2VzTGVuZ3RoOiBudW1iZXIsXG5cdFx0ZmluYWxJbmRpY2VzOiBOdW1iZXJBcnJheUxpa2UsXG5cdFx0ZmluYWxJbmRpY2VzTGVuZ3RoOiBudW1iZXIsXG5cdFx0ZGFya1RpbnQ6IGJvb2xlYW5cblx0KTogdm9pZCB7XG5cdFx0dGhpcy50ZXh0dXJlID0gc2xvdFRleHR1cmUudGV4dHVyZTtcblxuXHRcdGNvbnN0IHZlcnRMZW5naHQgPSAoZmluYWxWZXJ0aWNlc0xlbmd0aCAvIChkYXJrVGludCA/IDEyIDogOCkpICogMjtcblxuXHRcdGNvbnN0IHRleHR1cmVDb29yZCA9IHRoaXMuZ2VvbWV0cnkuZ2V0QnVmZmVyKFwiYVRleHR1cmVDb29yZFwiKTtcblx0XHRpZiAodGV4dHVyZUNvb3JkLmRhdGE/Lmxlbmd0aCAhPT0gdmVydExlbmdodCkge1xuXHRcdFx0dGV4dHVyZUNvb3JkLmRhdGEgPSBuZXcgRmxvYXQzMkFycmF5KHZlcnRMZW5naHQpO1xuXHRcdH1cblxuXHRcdGNvbnN0IHZlcnRleENvb3JkID0gdGhpcy5nZW9tZXRyeS5nZXRCdWZmZXIoXCJhVmVydGV4UG9zaXRpb25cIik7XG5cdFx0aWYgKHZlcnRleENvb3JkLmRhdGE/Lmxlbmd0aCAhPT0gdmVydExlbmdodCkge1xuXHRcdFx0dmVydGV4Q29vcmQuZGF0YSA9IG5ldyBGbG9hdDMyQXJyYXkodmVydExlbmdodCk7XG5cdFx0fVxuXG5cdFx0bGV0IHZlcnRJbmRleCA9IDA7XG5cblx0XHRsZXQgdGV4dHVyZUNvb3JkRGF0YSA9IHRleHR1cmVDb29yZC5kYXRhO1xuXHRcdGxldCB2ZXJ0ZXhDb29yZERhdGEgPSB2ZXJ0ZXhDb29yZC5kYXRhO1xuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgZmluYWxWZXJ0aWNlc0xlbmd0aDsgaSArPSBkYXJrVGludCA/IDEyIDogOCkge1xuXHRcdFx0bGV0IGF1eGkgPSBpO1xuXG5cdFx0XHR2ZXJ0ZXhDb29yZERhdGFbdmVydEluZGV4XSA9IGZpbmFsVmVydGljZXNbYXV4aSsrXTtcblx0XHRcdHZlcnRleENvb3JkRGF0YVt2ZXJ0SW5kZXggKyAxXSA9IGZpbmFsVmVydGljZXNbYXV4aSsrXTtcblxuXHRcdFx0YXV4aSArPSA0OyAvLyBjb2xvclxuXG5cdFx0XHR0ZXh0dXJlQ29vcmREYXRhW3ZlcnRJbmRleF0gPSBmaW5hbFZlcnRpY2VzW2F1eGkrK107XG5cdFx0XHR0ZXh0dXJlQ29vcmREYXRhW3ZlcnRJbmRleCArIDFdID0gZmluYWxWZXJ0aWNlc1thdXhpKytdO1xuXG5cdFx0XHR2ZXJ0SW5kZXggKz0gMjtcblx0XHR9XG5cblx0XHRpZiAoZGFya1RpbnQgJiYgIXRoaXMud2FybmVkVHdvVGludCkge1xuXHRcdFx0Y29uc29sZS53YXJuKFwiRGFya1RpbnQgaXMgbm90IGVuYWJsZWQgYnkgZGVmYXVsdC4gVG8gZW5hYmxlIHVzZSBhIERhcmtTbG90TWVzaCBmYWN0b3J5IHdoaWxlIGNyZWF0aW5nIHRoZSBTcGluZSBvYmplY3QuXCIpO1xuXHRcdFx0dGhpcy53YXJuZWRUd29UaW50ID0gdHJ1ZTtcblx0XHR9XG5cblx0XHRTbG90TWVzaC5hdXhDb2xvclswXSA9IGZpbmFsVmVydGljZXNbMl07XG5cdFx0U2xvdE1lc2guYXV4Q29sb3JbMV0gPSBmaW5hbFZlcnRpY2VzWzNdO1xuXHRcdFNsb3RNZXNoLmF1eENvbG9yWzJdID0gZmluYWxWZXJ0aWNlc1s0XTtcblx0XHRTbG90TWVzaC5hdXhDb2xvclszXSA9IGZpbmFsVmVydGljZXNbNV07XG5cblx0XHR0aGlzLnRpbnQgPSBTbG90TWVzaC5hdXhDb2xvcjtcblx0XHR0aGlzLmFscGhhID0gU2xvdE1lc2guYXV4Q29sb3JbM107XG5cdFx0dGhpcy5ibGVuZE1vZGUgPSBTcGluZVRleHR1cmUudG9QaXhpQmxlbmRpbmcoc2xvdEJsZW5kTW9kZSk7XG5cblx0XHRjb25zdCBpbmRleEJ1ZmZlciA9IHRoaXMuZ2VvbWV0cnkuaW5kZXhCdWZmZXI7XG5cdFx0aWYgKGluZGV4QnVmZmVyLmRhdGEubGVuZ3RoICE9PSBmaW5hbEluZGljZXMubGVuZ3RoKSB7XG5cdFx0XHRpbmRleEJ1ZmZlci5kYXRhID0gbmV3IFVpbnQzMkFycmF5KGZpbmFsSW5kaWNlcyk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGNvbnN0IGluZGV4QnVmZmVyRGF0YSA9IGluZGV4QnVmZmVyLmRhdGE7XG5cdFx0XHRmb3IgKGxldCBpID0gMDsgaSA8IGZpbmFsSW5kaWNlc0xlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdGluZGV4QnVmZmVyRGF0YVtpXSA9IGZpbmFsSW5kaWNlc1tpXTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHR0aGlzLm5hbWUgPSBzbG90TmFtZTtcblxuXHRcdHRleHR1cmVDb29yZC51cGRhdGUoKTtcblx0XHR2ZXJ0ZXhDb29yZC51cGRhdGUoKTtcblx0XHRpbmRleEJ1ZmZlci51cGRhdGUoKTtcblx0fVxufVxuIl19